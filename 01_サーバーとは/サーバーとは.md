
# サーバーとは？  

## なにこれ？  
ITの仕事をしていると、サーバーという単語がよく出てきます。  
ある程度経験がある人は当たり前に使っている単語ですが、文脈によって指しているものが違うことがあり、新入社員の方などは聞いていて混乱するかも知れません。

この記事はそういった方たちが、サーバーという単語が指す意味合いを理解できるようになることを目的としています。


## 対象者
サーバーと聞いてもよく分からない人


## サーバー（Server）、クライアント（client）の意味 
serveという英単語は、「（飲食物などを）出す、（サービスなどを）提供する」という意味合いがあります。  
serverとは「（サービスなどを）提供する人や物」というような意味合いになります。  

また、提供されたサービスなどを利用する人や物を「client」といいます。  

- server（サーバー）  
(サービスなどを)提供する人や物。

- client（クライアント）  
(サービスなどを)利用する人や物。

  
ITの文脈で出てくるserver・clientも同じような意味合いになります。

- server（サーバー）  
ある機能やコンテンツについて、それを提供する側（応答する側）のコンピュータまたはアプリケーション  

- client（クライアント）  
ある機能やコンテンツについて、それを利用する側（要求する側）のコンピュータまたはアプリケーション


「あるサービスやコンテンツ」の例として、Webサイトがあります。  

例えばchromeなどのブラウザでamazonのWebサイトを表示する際、ブラウザはamazonのWebサイトを提供しているコンピュータ端末に、Webサイトのコンテンツ（Webサイトを表示するために必要なファイルなど）を取得する為にアクセスします。  
Webサイトを提供しているコンピュータ端末はそれに応答し、Webサイトのコンテンツを返却します。  
（「amazonのWebサイトを提供しているコンピュータ端末」は、おそらくamazonのどこかのデータセンターで稼働しており、amazonにより管理されているはずです。）  

この例では、ブラウザがクライアント、amazonのWebサイトを提供しているコンピュータ端末がサーバーとなります。  
（Webサイトを下さいと要求しているブラウザ側が「クライアント」、クライアントからの要求に応じてWebサイトに必要な情報を返却している側が「サーバー」）


<img src="画像/サーバー説明Webサイト例.png" style="width:680px;">
 

「あるサービスやコンテンツ」はWebサイト以外にも様々なものがあります。  
動画、画像、ExcelやPDFなどのファイルが提供されることもありますし、IPアドレスが提供されることもあります。   

どのようなコンテンツかに関わらず、あるコンテンツを提供する側が「サーバー」、利用する側が「クライアント」と呼ばれ、  
サーバーとクライアントのやりとりは以下の流れで行われます。  
1. クライアントがサーバーに要求（リクエスト）を投げる
1. サーバーが要求内容に応じた処理を行う（Webサイトのコンテンツの準備、IPの発行など）
1. サーバーがクライアントに処理の結果を返す（レスポンス）

<img src="画像/サーバー説明クライアントサーバーやりとり流れ.png" style="width:600px;">

ちなみに、クライアントからサーバーにWebサイトの情報を要求する際、サーバーの場所が分からないと要求が出来ません。  
この場所の情報は「IPアドレス」と呼ばれ、Webサイトを表示する際はブラウザ上に指定されたURLから判別可能です。  
ここでは詳しく説明しませんが、DNSという仕組みでURLに対応するIPアドレスを取得できます。   


## もう少し細かい言い方
サーバー・クライアントの説明時に、「～する側のコンピュータまたはアプリケーション」という表現をしました。  
コンピュータとそこに含まれる(インストールされている)アプリケーションをまとめてサーバーと呼ぶ場合もありますが、それぞれを明確に分けて呼ぶ場合もあります。  
決まった言い方は無いので人それぞれな部分はありますが、分けて呼ぶ場合は大体以下のように呼ばれます。

- クライアント側  
ある機能やコンテンツについて、それを利用する側（要求する側）の
  - アプリケーション 
→クライアントアプリ、クライアントソフト　などと呼ばれる

  - コンピュータ  
→クライアントマシン、クライアント端末　などと呼ばれる  

Webサイト表示の例でいうと、ブラウザがクライアント（アプリ、ソフト）、ブラウザを立ち上げてるPCがクライアント(マシン、端末)　ということになります。

サーバー側も同じです。
クライアントからの要求への応答は、サーバー側で起動しているアプリケーションが行っています。   

- サーバー側  
ある機能やコンテンツについて、それを提供する側（応答する側）の
  - アプリケーション
→サーバーアプリ、サーバーソフト　などと呼ばれる

  - コンピュータ  
→サーバーマシン、サーバー端末　などと呼ばれる  

Webサイト表示の例だと、サーバー端末にはWebサイトを返却する為のアプリケーションがインストールされています。  
（Apache HTTP Server、nginx、IISなどのアプリケーションがよく利用されます。詳しくは別記事で解説します）  
それらのアプリケーションがサーバーアプリ（ソフト）、それが稼働している端末がサーバーマシン（端末）ということになります。

<img src="画像/サーバー説明マシンソフト.png" style="width:800px;">


アプリやマシン固有の話題で、明確に２つを区別したい場合はこのように細かい言い方になる場合があります。  
利用(要求)する側か、提供(応答)する側かが重要な場合は、いちいち細かい言い方はせずにまとめて「クライアント」、「サーバー」ということが多いです。  
（クライアントサイド、サーバーサイドという事もあります。）


## ○○サーバー
サーバーについて、「ある機能やコンテンツ」を提供するものだと説明しました。  
Webサイトの表示を例に出しましたが、他にも様々な機能が提供されます。

- メールを送受信する機能
- ファイルを共有する機能
- IPアドレスを発行する機能  
- データベース機能

など

このうちのどの機能を提供しているサーバーかを判別する為に、機能名や、その機能のプロトコル（後述）を頭につけて呼ぶことも多いです。

例えば以下のように呼ばれます。
- Webサイトを提供しているサーバー  
Webサーバー、HTTPサーバー　など

- メール送信機能を提供しているサーバー  
メールサーバー、SMTPサーバー　など

- ファイル共有機能を提供しているサーバー  
ファイルサーバー、SMBサーバー　など

- IPアドレス発行機能を提供しているサーバー  
DHCPサーバー　など

HTTP、SMTP、SMB、DHCPの部分がプロトコルと呼ばれるものです。  

システム構成図などでサーバーの一覧を書く際などは、このように機能名やプロトコル名＋サーバーと書きます。   
(単に「サーバー」と書かれたものが複数あってもよく分からないので)  

ただ会話の中では、何のサーバーかが自明な場合は、省略して単にサーバーといわれる事も多いです。  
（例えばWebサイト表示の話をしている場合、サーバーはWebサーバーを指すと予想できる。）    


#### プロトコルとは  
ある機能において、クライアントとサーバーがやり取りする為の仕様・ルールのことです。  
例えばWebサイトを表示する場合、クライアント側のアプリ（ブラウザ）と、サーバー側のアプリは、「HTTP」という仕様に則ってデータをやり取りしています。  
HTTPの仕様には、送受信するデータの形式などのルールが定義されています。  
（送信元IPはここに書く、このデータとこのデータの間は1行空ける、改行文字はCR＋LFとする、といったルールです。）  
この仕様は標準化団体により定められています。  

ブラウザにはChrome、Edge、Firefoxなど様々な種類がありますし、サーバー側のアプリもapache、nginx、IISなど様々な種類があります。  
上記のどんな組み合わせでもWebサイトを表示する事が可能です。  
それは、クライアント側・サーバー側両方のアプリが、「HTTP」という共通のルール（プロトコル）に従ってやりとりするよう実装されている為です。  

<img src="画像/プロトコル説明HTTP例.png" style="width:400px;">

HTTP、SMTP、SMB、DHCPなどのプロトコルも、クライアントとサーバーが通信する際のルールがそれぞれ決められています。  


## 「機能の提供」について
サーバーにおいて、「○○の機能を提供している」とは具体的にどのような状態でしょうか。  
それは、「○○の機能をもったアプリケーションが起動している状態」を指します。

例えばWebサーバーとは、「Webサーバーアプリがインストールされており、起動している（他の端末からの要求を受け付けられる）状態のコンピュータ」ということになります。  

<img src="画像/機能の提供説明Webサーバー.png" style="width:400px;">

あるコンピュータをWebサーバーとして利用する場合、大まかに以下の手順を踏むことになります。  
1. コンピュータにWebサーバーアプリをインストール[^3] 
1. インストールしたWebサーバーアプリを起動  
1. Webサーバーアプリが外部からの通信を受け付けられるように設定  

そのように設定できるコンピュータであれば何でもWebサーバーに出来ます。  
例えば、皆さんが使っているノートPCに上記の設定をすればそれはWebサーバーと言えます。


[^3]: サーバーのOSに初めから含まれている場合もあります。  
例えばWindosServerというOSにはIISというWebサーバーアプリが最初から含まれています。


また、1台のコンピュータで複数のアプリケーションを稼働させることも可能です。  
ある端末でWebサーバーアプリとDHCPサーバーアプリが稼働している場合、それはWebサーバー兼DHCPサーバーと言えます。  

<img src="画像/機能の提供説明Web兼DHCPサーバー.png" style="width:600px;"> 

1つのアプリケーションが複数の機能を提供することもあります。  

ただこのように1台の端末に色々な機能をまとめると、負荷が高くなったり、障害に弱くなったりする為、重要な機能は別々の端末にすることが多いです。  

### サーバーアプリとポート
上記のように複数の機能が提供されているサーバーにおいて、クライアントがどの機能に対してアクセス(リクエスト)してきたかをどのように判別しているのでしょうか。  
それは、サーバーアプリが紐ついているポートによって判断しています。

ポートで判断するための大まかな仕組みは以下になります。

1. クライアントアプリからサーバーにアクセスする際、サーバーのIPだけではなく、ポート番号も指定します。  
（どのポート番号を使用するかは、そのアプリが利用するプロトコルによって異なります。）

1. サーバー（のOS）がクライアントからのアクセスを受け付けた際、クライアントが指定したポートに紐ついているアプリにリクエストが来たことを通知します。

1. 通知を受けたアプリはリクエストの内容を取得し、必要な処理を行います。  

<img src="画像/機能の提供説明ポート例.png" style="width:700px;"> 

#### アプリとポートの紐付け
アプリがポート番号と紐ついていることを、アプリがポートをリッスン（LISTEN）していると言います。  
（正確にはアプリのプロセスがポートをリッスンしています。  
プロセスとは、「OS上で実行中のプログラム」を指します。  
Windowsならタスクマネージャーからプロセスの一覧を確認できます。）  

どのアプリがどのポートをLISTENしているかはOSが管理しており、アプリは起動時にOSに対してLISTENしたいポート番号を申請します。  
そうすることで、そのポートにリクエストが来た際にOSから通知をもらうことが出来ます。

１つのプロセスで複数のポートをLISTENすることも可能ですが、１つのポートに紐つくプロセスは１つと決まっています。  
その為、OSはあるポートへのアクセスをどのアプリへの通知すべきか判断することが出来ます。  


### プロトコル毎のポート番号
Webサイト表示について、サーバー－クライアント間はHTTPプロトコルに基づき通信すると説明しました。  
この際、サーバーごとにHTTP通信で使用するポートが異なっていると混乱してしまいます。  
(あるサーバーは81番ポート、別のサーバーは82番ポートを利用していたとすると、クライアント側はサーバーごとに通信するポートを変更しなくてはいけません。)   

その為、主要なプロトコルについては、使うべきポートがあらかじめ定義されています。  
（HTTPポートは80、HTTPSは443など）  
参考：[TCPやUDPにおけるポート番号の一覧](https://ja.wikipedia.org/wiki/TCP%E3%82%84UDP%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%9D%E3%83%BC%E3%83%88%E7%95%AA%E5%8F%B7%E3%81%AE%E4%B8%80%E8%A6%A7)  

あくまで使用が推奨されているだけなので、 セキュリティ対策などであえて違うポートを使用することもあります。  
（大半のアプリは設定でLISTENするポートを変更できます。）

ただ一般に公開されているWebサイトなどはデフォルトのポート番号を使うことがほとんどです。  
（前述したようにクライアント側の対応が必要になる為。例えばWebサイトをHTTP標準の80ポートではなく81ポートで公開した場合、クライアント側はアクセスする際にURLに:81と付けなくてはいけません。）


#### 送信元のポート番号
プロトコルごとにサーバー側の(標準の)ポートが定義されているのに対し、クライアント側の送信元ポートは定義されていない場合が多いです。  
(定義されている場合もあります。)  

DHCPなどはクライアント側の送信元ポートも定義されていますが、HTTPなどは定義されていません。  
定義されていない場合、クライアント側のアプリ(ブラウザなど)は空いているポートを送信元ポートとして使用します。  
（どの範囲のポート番号から送信元ポート番号を選ぶかはOSに設定されています。）

<img src="画像/プロトコル説明送信元ポート.png" style="width:700px;"> 



## サーバー用の機器
前述の通り、サーバーとはある機能を提供しているコンピュータのことであり、その機能さえ提供できればノートPCなどをサーバーとして利用する事が可能です。  

例えば少人数の会社で数人の社員しか利用しない場合や、個人で利用する場合は、余っているPCをサーバーとして使う、ということもあるかと思います。  

ただインターネットに公開しているサーバー（企業サイトを公開しているWebサーバーなど）など、多数のクライアントからアクセスされる可能性があるサーバーの場合、アクセス数が多くなるとサーバーに対する負荷が高くなります。  
その場合、個人利用が目的のPCではスペック的に不足してしまう可能性があります。  

その為、負荷が高いサーバー用途に使える、ハード的に高スペックなサーバー用機器が販売されています。  

例  
<img src="画像/サーバー機器サンプル.jpg" style="width:500px;"> 

これらのサーバー用機器は、製品によりますが主に以下のような特徴があります。  

- CPU・メモリ・HDDなどを挿すためのスロットが多く、スペックを上げやすい。
- 予備電源を配置出来るなど、安定した稼働のためのパーツを取り付けられる。
- ラックにまとめて配置できるように形状が工夫されている。

サーバー機器の事を指してサーバーと言うこともあります。  
(サーバー機器を置き換えたい、という文脈の話をしている場合など)  


### クラウドやレンタルサーバーの利用
サーバー用の機器を購入した場合、機器を置くスペースを確保したり、機器を自分たちでメンテナンスしていく必要があります。  
機器を配置するスペースの温度管理などもしなければいけないですし、地震などで倒れないような考慮もする必要があります。  
また機器をメンテナンスするにはスキルを持った人員を確保する必要があります。  

それらの負担を回避するために、レンタルサーバーやクラウドのIaasと呼ばれるサービスを利用する事も多いです。  

利用イメージは以下になります。  

1. 利用者が必要なスペック（メモリ、CPUなど）やOSの種類など指定  
（レンタルサーバーの提供業者が用意したWebサイトから指定出来ることが大半です。）

1. レンタルサーバーの提供業者が指定されたスペックのコンピュータを用意  
(このコンピュータは単にサーバーと呼ばれることも多いです。)

1. 利用者はリモート接続*でサーバーを管理

*OSがWindowsならリモートデスクトップ、LinuxならSSHで接続などで接続します。

<img src="画像/レンタルサーバーイメージ.png" style="width:600px;"> 


### サーバー仮想化
1台のコンピュータを複数台の仮想的なコンピュータに分割して利用する仕組みです。  
仮想化ソフトウェアを用いて実現します。  
仮想的なコンピュータは、仮想サーバー、仮想マシン(VirtualMachine)などと呼ばれます。  
（ベースとなるサーバーは「物理サーバー」などと呼ばれます。）  
それぞれの仮想サーバーではOSやアプリケーションを実行させることができ、あたかも独立したコンピュータのように使用することができます。

<img src="画像/仮想サーバー.png" style="width:600px;"> 

仮想サーバーを利用する事で、サーバーを増やすごとにサーバー機器を新たに購入することを避けることができます。  
（高スペックな物理サーバーを用意しておき、新しいサーバーが必要になった際はその上に仮想サーバーを作成するようにする。）  

前述のレンタルサーバーやクラウドサービスで貸し出されるサーバーも、裏ではこの仮想化技術を用いていることが大半です。  


クライアント側からみると仮想サーバーでもそうでないサーバーでも関係なく、ただの1台のサーバーに見えます。


## Windowsのサーバーエディション  

Windowsには、Windows10などの個人用OSと、WindowsServerというサーバー用OSがあります。  

両方のOSで元となるソースコードは共通です。  
(例えばWindows 10 AnniversaryUpdateとWindowsServer 2016、Windows10バージョン1809とWindowsServer2019は同じコードベース)  
その為、見た目も似てますし共通の機能も多いです。  

ただ、WindowsServerはサーバー用途に向けて機能が調整されています。  
例えば以下のような特徴があります。  

- 様々な役割として利用できるよう、必要な機能があらかじめ含まれている、または容易にインストール出来る。  
（Webサーバー、DHCPサーバーなどとして利用したい場合に簡単にセットアップ出来る）  

<img src="画像/WindowsServer役割ウィザード.png" style="width:600px;"> 

- 認識できるリソースが多い。  
例えばメモリは最大24TB、CPUソケットは64個まで認識できる。  
（Windows10ではメモリ2TB、CPUソケット2個が上限）

- セキュリティ関連の機能が豊富  


Windows10などの個人用OSをサーバーとして利用することも可能です。   
(例えばWindows10でIISを有効にすればWebサーバーとして使えます。)  

ただ業務用途ではセキュリティなどの信頼性が求められることが多い為、サーバー用のWindowsServerが使われる事がほとんどです。  
(サーバーOSをWindowsにする場合の話です。  
そもそもサーバー用のOSとしてはWindowsではなくLinux系が使われることも多いです。)

文脈によってはサーバーOSの事を指してサーバーという事もあります。



## まとめ
- 機能を提供する側をサーバー、利用する側をクライアントと呼びます。
- アプリケーションと端末を区別して呼ぶ場合もあります。
- 機能名や、その機能のプロトコルを頭につけて○○サーバーと呼ぶ場合もあります。
- ある機能を提供している状態とは、その機能をもったアプリケーションが稼働している状態を指します。
- サーバー側のアプリケーションは、特定のポートと紐ついています。
- プロトコル毎に使用すべきポートが決められています。
- サーバーの高負荷な用途に耐えられるサーバー用の機器があります。
- WindowsServerはサーバー向けに機能が調整されたWindowsOSです。

