# Javascriptとは

## Javascriptとは
JavaScriptは第一級関数を持つ軽量、インタプリタ方式、オブジェクト指向の言語です。  
(よくJSと略されます。)   
ブラウザ上で動作でき、Webページがどのようにふるまうかをプログラム出来ます。  

ブラウザ上で動作する際は、ボタンをクリックした、などの出来事(イベントといいます)に応じた処理を記述することが多いです。  
以下の例では、ボタンをクリックすると画面上のカウントが増えていきます。    
```html
<script>
  let count = 0;

  function countUp () {
    count += 1;
    document.getElementById("count").textContent = count;
  }
</script>

～中略～

<button onclick="countUp()">ボタン</button>
<label id="count">0</label>
```

<img src="画像/Webページの仕組み_Javascript例.gif" style="width:160px;">   

JavascriptもHTML、CSSと同じく標準化団体によって仕様が定められています。  
その為、どのブラウザでも同じようにJavascriptは実行されます。  

*ちなみに、Javascriptは[Java](https://www.java.com/ja/download/help/whatis_java.html)とは全く関係のない別の言語です。  
（名前にjavaとついていて構文も似ていますが全くの別物です。）  
  

## Javascriptの仕様 
Javascriptの仕様も標準化団体によって定められているのですが、以下の2つの仕様があります。  

1. Javascript自体の言語仕様  
   例えば変数やメソッドの定義の仕方などの、基本的な文法の定義です。  
   TC39という団体により定義されており、その仕様は[ECMAScript](https://tc39.es/ecma262/)と呼ばれています。  


1. Webブラウザ環境で実行する場合特有の機能の仕様  
   HTML要素の操作など、ブラウザ環境で実行される場合にだけ利用できるオブジェクトやメソッドがあります。  
   これらは**Web API**と呼ばれ、HTMLと同じ[Living Standard](https://html.spec.whatwg.org/)の一部として仕様が定義されています。  
  
   Javascriptをサーバーサイドで動かす場合もあるのですが(node.jsなどを利用)、その場合ブラウザ特有の機能(Web API)は利用できません。    

**Javascript自体の言語仕様については範囲が広すぎるのでここでは説明しません。**  
以下のサイトなどを参照下さい。  
[JavaScript Primer](https://jsprimer.net/)

以下ではブラウザ上で動作する場合のJavascriptの動作について説明していきます。  
（Javascriptの基本的な文法は分かっている前提で進めます）  

## Javascriptが実行される環境  
HTMLファイルに記載されたJavascriptは、ブラウザ上で実行されます。   
主要なブラウザはJavascriptの実行エンジンを持っており、HTML内のjavascriptを解析して実行します。  
サーバー側はJavascriptの文字列を返却しているだけです。 

<img src="画像/Webページの仕組み_Javascriptの読み込み.png" style="width:480px;">  

※JavascriptはHTMLに記載されている場合と、別ファイルに定義されている場合があります。  
詳しくは後述します。  

Javascriptに定義された関数や変数は、別ページを表示する、またはページが再読み込みされるまで保持されます。  
違うURLへの遷移やページリフレッシュなどで画面全体が再読み込みされた場合、読み込んだJavascriptの情報(定義されていた変数や関数など)はクリアされます。  

また、Javascirptが実行された結果は、そのブラウザのタブのみで起こっていることです。  
他のクライアントや、ブラウザの他のタブには影響しません。 

<img src="画像/Webページの仕組み_Javascript_各クライアントでの実行.png" style="width:480px;">  

## Javascriptの記載場所
JavascriptはHTMLファイルに記載することが出来ます。 
記載方法は３つあります。  

### 要素のイベント属性に直接指定する  
HTMLのイベントハンドラ属性(後述)に直接設定します。  
例  
```html
<button onClick="alert(`サンプルです`)">クリック</button>
```

この方法は改行なども出来ず、記述が色々な箇所に散らばってしまうため推奨されません。  

### `<script>`タグの内部に記載する  
HTMLの`<script>`タグ内に記載します。  
そこで定義した関数を、イベント発生時に呼び出します。   

例  
```html
<script>
  function myOnClick(){
    alert("サンプルです。")
  }
</script>

～～略～～

<button onClick="myOnClick()">クリック</button>
```


### 外部ファイルに記載し、`<script>`タグから参照する
CSSと同じように、JavascriptもHTMLと別のファイルに定義できます。  
HTMLの`<script>`タグの`src`属性でそのファイルのURLを指定すると、ブラウザがそのファイルを読み込み適用してくれます。 

・外部Javascript
myscript.js
```js
function myOnClick(){
  alert("サンプルです。")
}
```

・HTML
```html
<!-- srcに指定したパスから取得した外部JSがここに埋め込まれるイメージ。 -->`
<script src="http://～/myscript.js"></script>

～

<button onClick="myOnClick()">クリック</button>
```


複数のページで使われる共通の処理は外部ファイルとして定義します。  
そのページ(HTML)内でのみ利用される処理も外部ファイルに定義することが多いですが、そのページの`<script>`タグに記載する場合もあります。  


## Javascriptが実行されるタイミング
Javascriptはブラウザに解析された際にすぐに実行されます。  
HTMLは上から順にタグを解析していくのですが、`script`タグが現れたタイミングでそこに記載されたJavascriptが実行されます。  

その際に関数・変数の定義やイベントハンドラの登録を行っておき、実際の処理は**イベント**が発生した際に実行されることが多いです。  
（この記事先頭のサンプルのようなイメージです）  


ただそのタイミングではブラウザもHTMLを全て解析していないことが多く、Javascriptで画面に関する処理を記載しても反映されません。  
例えば「ある要素の値を変える」という処理を書いても、その要素が`<script>`タグより下にあった場合、まだブラウザに認識されていないため何も起こりません。  


## イベント 
イベントとは、ある要素に対して行った動作や、起きた出来事の事です。  
(クリックされた、キーが押された、要素が読み込まれた、など)

HTMLはこのようなイベントが発生した際に特定のJavascriptを実行することが出来ます。  
イベントに対し実行する処理を登録する仕組みを**イベントハンドラ**と呼びます。 

### イベントハンドラ
イベントハンドラはイベント毎に用意されています。  
例えばクリックされた際のイベントには`onclick`、テキストボックスなどフォームコントローの値が変更された場合は`onchange`というイベントハンドラが用意されています。  

例えばボタンのクリックイベントのハンドラを指定する際は以下のように記載します。    
```html
<button onclick="alert('テスト')">ボタン</button>
```
この場合、このボタン要素がクリックされると`alert('テスト')`が実行されます。  

図(gif)  

（この例ではHTMLの属性としてJavascriptを指定していますが、この方法は推奨されていません。  
動きをイメージしやすい為、説明の為に利用しています。    
イベントハンドラの指定方法は複数あり、後ほど説明します。）      


他にも例えば以下のようなイベントがあります。 

- onkeypress  
要素がフォーカスされている時にキーボードのキーが押された際に実行される。   

- ondblclick   
要素がダブルクリックした際に実行される。    

その他にも様々なイベントが定義されています。  
[イベント一覧](https://developer.mozilla.org/ja/docs/Web/Events#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E4%B8%80%E8%A6%A7)

### イベントハンドラの設定方法
イベントハンドラの設定方法は３つあります。  

- インラインイベントハンドラー  
例で紹介したように、HTML要素の属性として実行するJavascriptを記述する方法です。  

   ```html
   <button onclick="var message='テスト';alert(message)">   ボタン</button>
   ```
   scriptタグで定義した関数を指定する事も出来ます。  
   ```html
   <script>
     function showMessage()  {
       alert("テスト")
     }
   </script>

   <button onclick="showMessage();">ボタン</button>
   ```

  この方法だと文字列のダブルクォートなどを気にしないといけなくなり、改行なども記載できません。  
  また要素数が増えるとどこにイベントが書かれているか分かりにくくなります。  
  その為、使用は推奨されません。  

- DOMで取得した要素に指定  
後述するDOM APIを利用して要素を取得することが出来ます。 
その要素オブジェクトにイベントを指定できます。  

   ```js
   <button id="mybutton">ボタン</button>

   <script>
     function showMessage(e)  {
       alert("テスト")
     }
     
     const button = document.getElementById('mybutton');
     button.onclick = showMessage;
   </script>
   ```

- addEventListenerでの指定  
DOM APIで取得したオブジェクトには、`addEventListener`という関数が用意されています。  
この方法だと1つのイベントに複数のハンドラを指定できます。  

   ```html
   <button id="mybutton">ボタン</button>

   <script>
     function showMessage1()  {
       alert("テスト1")
     }
     
     function showMessage2()  {
       alert("テスト2")
     }
     
     const button = document.getElementById('mybutton');
     button.addEventListener('click', showMessage1);
     button.addEventListener('click', showMessage2);
   </script>
   ```

イベントハンドラに指定した関数には、イベントに関する情報を保持するイベントオブジェクトが引数として渡されます。  
[イベント](https://developer.mozilla.org/ja/docs/Web/API/Event)

DOM APIかaddEventListenerのいづれかで指定することが推奨されています。   

イベントに関する詳しい情報は以下のページを参照ください。  
[イベントへの入門](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Building_blocks/Events)   

## WebAPI
ブラウザ環境で実行されるJavascriptには、ブラウザやWebページを操作する為の様々にオブジェクトやメソッドが用意されています
。  
これをWebAPIと呼びます。  

WebAPIには例えば以下のようなものがあります。  

- windowオブジェクト  
  表示しているWebページ全体の情報や、それを操作する為の関数を保  持します。  
  コード例にあった、メッセージダイアログを表示する`alert`という  関数もwindowオブジェクトが持つ関数の一つです。  
  windowのもつ関数は`window.`の部分を省略して呼び出すことが可能  です。  
  例えば`alert()`は`window.alert()`とも書くことが出来ます。  
  
  [windowAPI](https://developer.mozilla.org/ja/docs/Web/API/Window)


- historyオブジェクト  
ブラウザの戻る・進むに関する処理を行う関数を保持しています。  
[HistoryAPI](https://developer.mozilla.org/ja/docs/Web/API/History)

- DOM API  
HTML要素を操作する為のオブジェクトや関数です。  
よく利用する為、次の項で解説していきます。  

他にも様々なAPIが用意されています。  
[Web API 一覧](https://developer.mozilla.org/ja/docs/Web/API)  

これらのAPIを利用し、WebページをJavascriptから操作していきます。  

## DOM API
ブラウザが読み込んだHTMLの要素を操作する為の関数です。  
例えば以下のような処理が出来ます。  

- 特定の要素の情報を変更する
idなどの条件から特定の要素を取得し、その要素の情報を変えることが出来ます。  
例えば、ボタンをクリックした際に別の要素のテキストを変更する場合、以下のコードになります。  
   ```html
   <button id="mybutton">ボタン</button>
   <label id="mytext"></label>
   
   <script>
     let count = 0;
   
     function countUp()  {
       count++;
       const textElement = document.getElementById("mytext");
       //要素の要素内容を変更
       textElement.text = `count`;
     }
   
     const buttonElement = document.getElementById("mybutton");
     //要素にイベントを設定
     buttonElement.onclick = countUp;
   </script>
   ```
   
   図gif  
   
   要素を取得する方法は他にも、name属性で取得する、CSSと同じセレクタで取得する、などがあります。  

- 新たな要素を作成する
   ```html
   <button id="mybutton">ボタン</button>
   <label id="mytext"></label>
   
   <script>
     let count = 0;
   
     function countUp()  {
       count++;
       const textElement = document.getElementById("mytext");
       //要素の要素内容を変更
       textElement.text = `count`;
     }
   
     const buttonElement = document.getElementById("mybutton");
     //要素にイベントを設定
     buttonElement.onclick = countUp;
   </script>
   ```
   図gif  

他にも要素を削除するなど、様々な操作を行えます。  
[DOM API一覧](https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model)  

このようなDOM APIは、[Ajax](2_1.ブラウザがHTTPリクエストを送るタイミング.md#ajaxの実装)と呼ばれる処理でもよく利用されます。  

## 参考情報

[イベントへの入門](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Building_blocks/Events)   

[WEB API](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction)

[Web APIとは](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction)

[Web API 一覧](https://developer.mozilla.org/ja/docs/Web/API)

[DOM API](https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model/Introduction)

[DOM API一覧](https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model)  

