
# Webサイトを表示する仕組み

## なにこれ？  
皆さんが普段ブラウザから閲覧しているAmazonやYoutubeなどのWebサイトについて、どのような仕組みで表示されているかご存じでしょうか？  

何気なく表示しているWebサイトですが、その裏ではWebに関する様々な技術が使われています。  

ChromeやSafariなどのブラウザから、amazonやyoutubeなどのWebサイトにアクセスしたことがある方は多いかと思います。  
ただ、そのWebサイトがどのような仕組みで表示されているのかまでは分からない方もいるのではないでしょうか。

弊社の開発案件ではWebサイトを作成することも多いため、仕組みかを理解しておく必要があります。

その為、どのような仕組みでWebサイトが表示されているかを理解しておく必要があります。  

この記事はWebサイトを表示する仕組みを理解することを目的としています。


## 対象者
Webサイトを表示する仕組みがいまいちよく分からない人  

## 読み方
この記事は概要を説明しており、細かい内容は別の記事で記述しています。  
まずはこの記事を最後まで読んでもらい、その後に詳細の記事を読むのが読みやすいかと思います。  


## Webサイト表示の仕組み
ブラウザのURL欄にWebサイトのURLを入力しEnterを押すと、そのWebサイトの画面がブラウザに表示されます。  
その際、ブラウザとWebサイトを供給しているWebサーバーの間でどのようなやりとりが行われているのでしょうか？  
以降では、Webサイトが表示されるまでの仕組みについて説明していきます。  

まず、Webサイト表示に関して登場する重要なキーワードについて簡単に説明します。  

- クライアント（ブラウザ）  
URLを元にWebサーバーにアクセスし、Webページを表示します。  

- URL
クライアントがアクセスするリソース（この場合HTML）の場所を示します。  

- Webサーバー  
リクエストされたリソース（この場合HTML）をブラウザに返却します。  

- HTTP  
クライアント・Webサーバー間の通信規約（プロトコル）です。  

- HTML 
ブラウザにどのような画面を描画するかを伝える文字列データです。  

これらの大まかな関係は以下のようになります。  

<img src="画像/Webページの仕組み_重要キーワードの関連.png" style="width:480px;">


## クライアント・サーバー間の処理の流れ   
Webページを表示するまでの過程をもう少し詳しく見ていきましょう。   


<img src="画像/Webページの仕組み_Webサイト表示の流れ.png" style="width:680px;">


1. （人）ブラウザ上にURLを入力


1. （ブラウザ）URLからWebサーバーのIPを取得  
通信先のWebサーバーのIPを、DNSという仕組みを利用して取得します。  


1. （ブラウザ）Webサーバーに対してHTTPリクエストを送信  
どのページを開きたいかなどの情報を含んだ、Httpリクエストという文字列をWebサーバーに送信します。  

1. （Webサーバー）HTTPリクエストを受け取り、ブラウザに返却するHTMLを作成  
Htmlとは、ブラウザにどのような画面を描画するかを伝える為の文字列データです。  
後ほど説明します。  


1. （Webサーバー）HTTPレスポンスと呼ばれる形式のメッセージで用意したHTMLを返却


1. （ブラウザ）HTTPレスポンスからHTMLを取り出し、その内容に応じで画面を描画する。



以下それぞれのフェーズについて説明していきます。

## 各部分の詳細

### 1.（ブラウザ）URLからWebサーバーのIPを取得  
ブラウザはまずURLを解析し、リクエストを送る先のサーバーの場所（IP）を特定します。    
ここで、URLについて簡単に説明します。   

#### URLとは  
URLとは、ネットワーク上のリソースの場所を表すための識別子です。  
Webページや画像など、ネットワーク上にあるデータ（これを**リソース**といいます）の位置を一意に表します。  

Webページを開く際は、URLで対象リソース(Webページ)の場所を特定し、そのリソースをHTTPプロトコルで取得する、というのが基本的な流れになります。  
(HTTPについては[別記事]()で解説します。)


#### URLの構文
URLはいくつかの要素で構成されています。  

例えば以下のURLがあった場合  
```http://example.com/user/mypage```  
以下のように分解できます。  

<img src="画像/URLとは_URLの構成要素_1.png" style="width:360px;">

このうち、IPを取得する為に使うのは**ホスト名**になります。  
ホスト名にはドメイン名と呼ばれる文字列を指定されています。  

インターネットの世界では、DNSという仕組みでドメイン名とIPアドレスの対応付けを管理しています。  
これを管理しているDNSサーバーにドメイン名を問い合わせ、対応するIPを取得します。   


#### DNSサーバーからのIPの取得手順  
DNSサーバーからWebサーバーのIPを取得する手順は大まかに以下になります。  

1. URLからホスト名を取得

2. ホスト名に対するIPをDNSサーバーに問い合わせる  
ホスト名に対応するIPを取得する為には、DNSという仕組みを利用します。  
DNSとは、インターネット上でドメイン名を管理・運用するための仕組みで、
ドメイン名に対応するIPなどの情報を管理しています。  

ブラウザはDNSサーバーに対して、ドメインに対するIPを教えて下さいとリクエストすることになります。  
DNSに問い合わせる機能自体は実際はOSが持っており、ブラウザはOSが提供する機能を利用して問い合わせを行っています。  

<img src="画像/Webページの仕組み_DNSサーバーへの問い合わせ.png" style="width:680px;">

DNSサーバーはOSに設定されています。  
例えばWindowsだと以下の画面から設定できます。  

<img src="画像/Webページの仕組み_DNSの設定箇所.png" style="width:680px;">


DNS関連はネットワーク的な話になるので、概要だけの説明になります。  
詳しく知りたい方は以下の書籍を参照してください。  
[ネットワークはなぜつながるのか](https://www.amazon.co.jp/dp/4822283119)



### 2.（ブラウザ）Webサーバーに対してHTTPリクエストを送信  
ブラウザはHTTPリクエストというメッセージをWebサーバーに送信します。  
まずはHTTPとは何かについて簡単に説明します。  
(もう少し詳しい説明は別記事で行います。)  

### HTTPとは  

クライアント（ブラウザなど）とWebサーバーの間で、さまざまなデータを転送するために使用するプロトコル（通信規約）のことです。
（Htmlだけではなく、画像、動画、PDFなど、コンピュータで扱えるデータなら何でも転送出来ます。）  


HTTPでは、クライアントとサーバー間で**HTTPメッセージ**と呼ばれる文字列データをやり取りして必要な情報を伝え合います。    
まずはクライアントがメッセージを送り、それに応答するメッセージをサーバーが返します。  

それぞれのメッセージは次のように呼ばれます。  
- HTTPリクエストメッセージ  
クライアントが送信してサーバーにアクションを起こさせる為のHTTPメッセージ  

- HTTPレスポンスメッセージ  
HTTPリクエストに対するサーバーの回答であるHTTPメッセージ  

<img src="画像/HTTPとは_HTTPメッセージ.png" style="width:480px;">
  

メッセージの仕様（どこにどんな情報をどうやって記載するか）はHTTPプロトコルの仕様の1部として[規定](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)されています。  

以下それぞれのメッセージの形式について説明します。  

### HTTPリクエスト  
HTTPリクエストは、以下のような文字列になります。  
例（http\//example.com/user/registerにアクセスした場合）  

```
POST /user/register HTTP/1.1
Accept: text/html,application/xhtml+xml;q=0.9,*/*;q=0.8
Content-Length: 28
Content-Type: application/x-www-form-urlencoded
Host: example.com

name=yamada&tel=000-0000-000
```


HTTPリクエストは大まかに以下のブロックに分かれます。  

<img src="画像/HTTPとは_HTTPリクエスト.png" style="width:480px;">


- リクエストライン（1行目）  
サーバーにリクエストの種類を伝えるために使用するHTTPメソッドや、URLのドメイン名以降の部分が入ります。 

- HTTPヘッダー（2行目～空行まで）   
サーバーに補助的な情報を伝える目的で使われます。  
例えばレスポンスの言語を指定したり、Cookie（別記事で解説）を記載できます。  


- 本文（空行から後ろ）  
ユーザーが入力した情報などを記載します。  


### HTTPレスポンス
HTTPリクエストに対する応答として、WebサーバーはHTTPレスポンスメッセージをブラウザに送信します。  
HTTPレスポンスにはHtmlなどのブラウザ側に返却したいコンテンツ情報が含まれています。  

HTTPレスポンスは、以下のような文字列になります。  
例  
```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Date: Tue, 31 May 2022 09:57:26 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT

<!doctype html>
<html>
  <head></head>～～<body></body>
</html>
```
（ヘッダーは表示幅の関係で省略しています。）


HTTPリクエストと同じく、HTTPレスポンスの構文もHTTPの仕様の一部として定義されています。
以下HTTPレスポンスの構造を簡単に説明します。  

<img src="画像/HTTPとは_HTTPレスポンス.png" style="width:480px;">

- ステータスライン （1行目） 
処理の結果を表すステータスコードなどが記載されます。

- レスポンスヘッダー（2行目～空行まで）    
リクエストと同じく、補助的な情報を伝える目的で使われます。  

- レスポンスボディ（空行から後ろ）  
ここに応答したい内容が入ります。  
Htmlファイルを返却したい場合は、Htmlファイルの内容が記述されています。  
404など、応答によっては本文が無いものもあります。  



メッセージを含むHTTPプロトコルの仕様は、IETFという標準化団体が[策定](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)しています。   

仕様としてメッセージの形式やヘッダーの意味が決められている為、クライアント・サーバーは相手からのメッセージを解析することが出来ます。  
(どこに何が書いてありどう意味かを機械的に判別できます。)  


#### Webサーバーに対してHTTPリクエストを送信  
元の話に戻ると、ブラウザはWebサーバーのIPを確認後、上記で説明したHTTPリクエストを生成し、Webサーバーに送信します。  
（HTTPレスポンスは、この後説明するWebサーバーが応答を返すタイミングで利用されます。）  

HTTPヘッダーはブラウザの実行状況（言語設定、cookieの状態、直前に見たURLなど）によりブラウザが自動的に作成します。  

例として、googleサイトを開いた際のリクエストを添付します。    

```
GET / HTTP/3
Host: www.google.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: ja,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Connection: keep-alive

```

Webサイトを表示する際、このようなHTTPリクエストの作成・送信処理をブラウザがやってくれているわけです。  




### 3.（Webサーバー）HTTPリクエストを受け取り、返却すべきHtmlを用意  

ブラウザから送られてきたHTTPリクエストをWebサーバーが受け取り、Webサーバーアプリに受け渡されます。  

Webサーバーアプリはリクエストの内容を解析し、リクエストの内容によって返すべきコンテンツを準備します。  
今回のような、ブラウザにURLが入力された際のリクエストに対しては、まず**HTML**という、Webページを表示する為の情報を記述した文字列データを返却します。  
(HTMLについては後ほど説明します。)  

どのようなHTMLを返すかは、URLのパスやパラメータによって判断します。  
例えばURLが/loginならログインページ表示用のHTMLを、/mypageならマイページ表示用のHtmlを返す、などです。  
このような、どのリクエストに対してどのコンテンツを返すかのルールは設計者・開発者が決めて実装します。  

Webサーバーは1台で稼働するのではなく、アプリケーションサーバー・データベースサーバーと連携しながら動作することが多いです。  
Webサーバーの説明は[別記事]()で行います。  



### 4.（Webサーバー）コンテンツをレスポンスメッセージで返却

Webサーバーは返却したい情報（この場合はHtml）をレスポンスメッセージとしてブラウザに送信します。  
上で説明したレスポンスメッセージの本文部分に、返却したい情報が記載されています。  
 
例  
```
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Date: Tue, 31 May 2022 09:57:26 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT

<!doctype html>
<html>
  <head></head>～～<body></body>
</html>
```
図  

Webサーバーはリクエストに応じて、このようなレスポンスを返却します。  


### 5.（ブラウザ）HTTPレスポンスからHtmlを取り出し、その内容に応じで画面を描画する。

図  

ブラウザがWebサーバーから返却されたHttpレスポンスを解析し、そのレスポンスボディからHTMLを読み取ります。  
HTMLには画面のどこに何を描画すべきかが記載されており、ブラウザはその内容に従って画面を描画します。  

以下HTMLについて簡単に説明します。  
（詳しい説明は[別記事]()で行い、ここでは概要だけを説明します。）  

#### HTMLとは
HTML(Hypertext Markup Language) は、訪れたWebサイトの構成をブラウザに対して伝えるために使うマークアップ言語です。  
HTML言語で書かれた文字列をブラウザに渡すと、ブラウザはその内容に沿った画面を描画してくれます。  

例えば、`<button>ボタンです</button>`というHTMLの場合、画面には以下のようにボタンが描画されます。  

<button>ボタンです</button> 

このように、`<></>`で囲まれた箇所を**タグ**と呼びます。 
このタグで囲まれた部分が何かをブラウザに伝えます。   
（この例では`<button>`で囲まれて部分がボタンである、とブラウザは認識し頑丈にボタンを描画します。）  
HTMLはタグを組み合わせることで、どのような画面を描画すべきか定義します。  

もう少し複雑なHTMLの例です。  
```
<!DOCTYPE html> 
<html>
  <head>
    <title>タイトルです</title>
  </head>
  <body>
    <h1>見出しです</h1>
    <button>ボタン</button>
  </body>
<html>
```
これは、ブラウザ上で以下のように描画されます。    
<html>
  <head>
    <title>タイトルです</title>
  </head>
  <body>
    <h1>見出しです</h1>
    <button>ボタン</button>
  </body>
<html>  


HTMLの仕様は、WHATWGという標準化団体により[策定](https://html.spec.whatwg.org/)されています。   
（文法やどのタグ何を表すかが定義されています。）  

主要なブラウザはこの仕様に従ってHTMLを解析し画面を描画します。  
あるWebページを開く際、どのブラウザでみても同じ画面が表示されるのはこのためです。  
(たまに特定のブラウザが対応していない仕様もありますが・・)


##### サーバー側の処理 

Webサーバー側は、ブラウザに表示したい画面のHTMLを作成しておき(もしくは動的に作成し)、ブラウザ側に返却します。  
例えばログインページにリクエストが来た際はログイン画面を表示する為のHTMLを返します。  

図  

HTMLの解析・画面の描画はブラウザが行ってくれるため、Webサーバー側には画面描画の仕組みを持つ必要はありません。  
ブラウザに(正しいHTML言語で書かれた)文字列を返せばいいだけです。  

 

#### HTTPレスポンスからHtmlを取り出し、その内容に応じで画面を描画する。

元の話に戻ると、このようにWebサーバーから返却されたHTMLをもとにブラウザが画面を描画してくれるわけです。  
WebサーバーはHTTPリクエストの内容からどの画面を開く為のリクエストかを判定し、対象画面のHTHMLを返却します。  

これでWebサイトを表示する際の流れの説明は完了です。   
（Htmlについてはこの後説明します。）  

みなさんがブラウザでWebサイトを見ている際は、このような処理をブラウザやWebサーバーが行ってくれています。  


### CSS、Javascriptについて 
HTMLだけでもブラウザは画面を描画できます。  
ただHTMLだけだと、見た目が質素で動きのないWebページになってしまいます。  

その為、デザインを指定する**Css**と、振る舞いを定義する**Javascript**と呼ばれるものを同時に利用することが多いです。  

これらについても概要を説明します。  
(詳しくは別記事で説明します。)  

#### それぞれの役割 
CSS、JavascriptはHTMLとは別の仕様(言語)であり、異なる文法で記述されます。  
ただしお互いに関連は深く、Htmlの特定の箇所に直接CSSやJavascriptを記載することが可能です。  
（Htmlとは別のファイルとして定義することも可能です。）  

HTML、CSS、Javascriptの役割は以下になります。  
- HTML  
Webサイトの構造（どこに何を表示するか）を定義します。  

- CSS  
Webサイトのデザインを定義します。  

- Javascript  
Webサイトの振る舞いを定義します。  

以下それぞれの概要を説明します。  

### CSSとは  
CSS(Cascading Style Sheets)とは、
HTMLの要素のスタイルやレイアウトを、どのように表現するか指定する言語です。  
幅・高さ・色など、見た目のデザインに関する情報を指定できます。

例えば、ある要素の背景色を青にするように指定しています。

例  
```
<h1 style="background-color:blue;">見出しです</h1>
```  

上記のHtmlは以下のように描画されます。  
<h1 style="background-color:blue;">見出しです</h1>
  

他にも、以下のような定義が可能です。

・width、height  
幅、高さを指定します。  
例  
`width:120px;height:120px;`  

・border
要素を囲む枠線の見た目を定義します。
例
``

他にも文字のサイズ・書体・色の変更や、各要素の間隔の幅の指定など、デザインに関する様々な設定が可能です。  

CSSの説明は[別記事]()で行います。    

#### CSSの仕様  
CSSの仕様はW3Cという団体によって[策定](https://www.w3.org/Style/CSS/specs.en.html)されています。 
HTMLと同じく、主要なブラウザはこの仕様に沿ってCSSを解析し画面に描画します。  

### Javascriptとは
Webサイトのふるまいを定義する為のプログラミング言語です。  
例えば、あるボタンが押された際にある処理を行う、などの処理を記述します。  

ボタンをクリックした、などの動作（イベントといいます）に応じて処理を行うことが多いです。  

例)ボタンをクリックするとカウントが増えていきます。    
```


```

詳しくは[別記事]()で解説します。  

ちなみに、[Java](https://www.java.com/ja/download/help/whatis_java.html)とは全く関係のない別の言語です。  
（名前にjavaとついていて構文も似ていますが全くの別物です。）  



#### Javascriptが実行される環境  
Webサーバーからのレスポンスに含まれるJavascriptは、ブラウザ上で実行されます。   

サーバー側はJavascriptの文字列を返却しているだけです。  
主要なブラウザはJavascriptの実行エンジンを持っており、サーバーから返却されたjavascriptの文字列を解析して実行します。  

図  

また、Javascirptが実行された結果（上の例の背景色の変更など）は、そのブラウザのみで起こっていることです。  
他のクライアントのブラウザに影響しません。  

図


図  
複数クライアントにjavascriptが返されてる図  


#### Javascriptの仕様 
JavascriptもHTML、CSSと同じく標準化団体によって仕様が定められています。  

- [javascript自体の言語仕様](https://tc39.es/ecma262/)  

- [Webブラウザ環境で実行する場合特有の機能の仕様](https://html.spec.whatwg.org/)  

（2つの仕様の違いは別記事で説明します。）

主要なブラウザはこの仕様にしたがってJavascriptを解析・実行します。  
その為、どのブラウザでも同じようにJavascriptは実行されます。  



## 仕様の策定について
HTTPやHTMLなどの仕様は仕様策定団体によって定義されており、主要なアプリ（ブラウザやWebサーバーアプリ）はその仕様に準拠する形で実装されています。  

例えば、ブラウザはHTTPリクエストを送る際、仕様通り先頭行に要求メソッドなどを記載します。  
Webサーバーアプリも仕様通り先頭行に要求メソッドなどが書かれている前提でHTTPリクエストを解析します。    

このように共通の仕様を前提に各アプリが実装されている為、どのような組合せでもHTTPのやり取りを行えるわけです。  

図  

もし共通の仕様が無ければ、特定のブラウザとWebアプリの組合せでしかやりとりが出来なくなってしまいます。  


もし共通の仕様が決まっていなければどうなるでしょうか。  
例えばブラウザやWebサーバーごとに想定するHttpリクエストの形式が異なっていると、特定のブラウザとWebアプリの組合せでしかやりとりが出来なくなってしまいます。  

図  


HTML、Css、Javascriptにも同じことが言えます。  
Htmlのタグやcssの意味、javascriptの構文やメソッドの処理内容などは、共通の仕様で定義されています。  
各ブラウザはその仕様をもとに実装されているので、どのブラウザで見ても同じWebページを表示できるわけです。  
(後述しますがたまに見れないときはあります。)  

図  
androidやiOSでも見れるのを表す  


もしブラウザごとにそれらの解釈が異なるのなら、各ブラウザ向けに返却するHTMLを変えなくてはいけなくなります。  

図  

そのような事態を避ける為に仕様策定団体が存在しており、各アプリの開発ベンダーもそれに従っているわけです。  

この仕様には強制力はありませんが、仕様に準拠していないアプリは扱いにくくなるため利用者が減ってしまいます。  
その為自然とこの仕様に従うようになります。  



このように共通の仕様や規格を作るのは、Webシステムに限った話ではありません。  
TCP/IPのようなプロトコルもそうですし、USBの形状なども共通の規格が決まっています。  
このように共通の仕様を決めることで、全体の利便性が高まるわけです。  



#### IE（Internet Explorer）について
各アプリが共通の仕様に準拠していると書きましたが、MicrosoftのIEは共通の仕様にあまり対応していませんでした。  
（Html・Css・Javascript関連で、「IEでは動作しない」という機能が多かったです。）  
  
その為、開発者はIE用と他のブラウザ用の２つの実装をコーディングしなくてはいけませんでした。   
（IEはWindows標準搭載で一定のシェアがあるため無視することは出来ませんでした。）  

ネットで調べ物をするとIEの場合はこうコーディングする、といった情報が書かれている場合がありますが、それは上記の理由の為です。  

IEは2022/6月でサポートが終了しますが、古い業務アプリなどはIEでしか動かないものもあるので注意が必要です。  


#### 各ブラウザの仕様対応状況  
各アプリは共通仕様に対応しようとしていますが、一部の機能に対応していないことがあります。  
特にブラウザ側はURI、Http、Html、css、javascript・・と対応しなければいけない仕様が多く、各ブラウザで対応状況に差があります。  

対応状況は[ここ]()で確認できます。  



## 参考資料  

- Webサイト  
[MDN HTTPについて](https://developer.mozilla.org/ja/docs/Web/HTTP)  
<br/>
[MDN URLとは何か](https://developer.mozilla.org/ja/docs/Learn/Common_questions/What_is_a_URL)  
<br/>
[MDN CSS](https://developer.mozilla.org/ja/docs/Web/CSS)  
<br/>
[MDN JavaScript](https://developer.mozilla.org/ja/docs/Web/JavaScript)  
<br/>
[JavaScript Primer](https://jsprimer.net/)  

- 書籍  
[ネットワークはなぜつながるのか](https://www.amazon.co.jp/dp/4822283119)  
