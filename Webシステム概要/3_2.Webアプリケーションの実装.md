# Webアプリケーションの実装

## なにこれ？ 
Webアプリケーションとはアプリケーションサーバー上で動作するプログラムのことです。  

このプログラムはどんな実装でもいいわけではなく、Appサーバーと協調して動作するように実装されていなくてはいけません。  
（例えば、コンソール画面にHelloWorldと出力するだけのプログラムを動作させることはできません）

ここでは、Webアプリケーションをどのように実装するかについて説明します。  


## AppサーバーとWebアプリケーション関係

Appサーバーは、特定のタイミングで配置されたWebアプリケーションを呼び出します。  
特定のタイミングとは、例えば配置されたWebアプリケーションの起動時HTTPリクエストの受付時、などです。  

このように、どのタイミングでどのメソッドを呼び出すかは、言語毎に仕様が定められています。  

例えば、Javaの場合はJavaServletという仕様が定められています。  

JavaのAppサーバーであるTomcatやJBossなどは、全てこのJavaServletの仕様に基づいてWebアプリケーションを呼び出します。  
(その為サーブレットコンテナとも呼ばれます。)

図  


## Webアプリケーションの実装 
WebアプリケーションもAppサーバーが従っている仕様に基づいた実装にしなくてはいけません。  

たとえばTomcatに配置したいアプリケーションは、各イベントで呼ばれるメソッドをJavaServletの仕様に定められたシグニチャ（メソッド名、引数、戻り値）で作成しなくてはいけません。  
例: 起動時に呼ばれるメソッド

```

```


## Webライブラリ
ただ、このように仕様に基づいて１から実装するのは大変です。  
また大半の処理はプログラムが変わっても共通です。  

その為、実際の開発ではWebライブラリ利用して実装することになります。

Webライブラリは、大半の処理で共通なAppサーバーとのやり取りの部分を主に実装しています。  
その為、開発者はプログラム毎に異なる部分だけを実装すればいいことになります。  
(Webライブラリの仕様に基づいて開発しなくてはいけないということでもあります。)  

例えば、javaだとj2ee.jarというものを利用します。  


例
```

```




このようなWebライブラリを利用したプログラムを作成することは難しくはありません。
主要なIDE（Eclipseなどの統合開発環境）では、Webライブラリを使用したプロジェクトを作るメニューが存在しており、これを利用すると簡単に作成できます。  


図  

結果の図  


最初から必要なメソッドが定義、設定された状態のプロジェクトが作成されますので、そのまま利用してもいいですし、必要な箇所は変更しながら利用できます。  


## Webフレームワーク

Webライブラリを使うとWebアプリケーションを作成することが出来ます。  
ただ、それでも少し記述な冗長なところがあります。  

その為、より容易に開発できるようなフレームワークが存在することが多いです。  

たとえばJavaの場合はSpringMVCなどが有名です。  

これらのフレームワークはサードパーティー製の場合もありますし、言語の自体の開発元が作成している場合もあります。  

例えば、.NETのWebフレームワークであるASP.NETはMicrosoftが開発しています。  

このような場合、Webフレームワークのみを意識すればよく、Webライブラリを意識する機会はあまりありません。  

例  
```

```

各言語ごとによく使われるWebフレームワークがあります。  
Java  Spring MVC 
.NET ASP.NET





## HTMLを作成しやすくする機能
Appサーバーは処理の結果として、動的に作成したHtmlなどの文字列を返します。  
（Javascriptやcssを動的に作る場合もありますし、Jsonの文字列を返す場合もあります。）  

ただ、そのような文字列は文字数も多くなる為、サーバー側の言語で作るのは大変です。  
例えば、JavaのServletでは以下のようなコードになってしまいます。  
```

```
こうすると開始タグと終了タグの関連も分かりにくくなりますし、ダブルクオーテーションなどをエスケープする必要もあります。  

これを解消する為、大半のWebライブラリは、このような文字列を簡単に作る為の機能を持っています。  
JavaだとJsp、ASP.NETだとRazorなどです。  
(同じ言語でも使っているライブラリやフレームワークにより異なります。)  

以下のように普通のテキストファイルのように自由に記述出来、サーバーアプリの変数も埋め込めます。  
JSPの例
```

```

実際にビルドするした際は、内部的に最初に見たような文字列を作成するコードに置き換えられます。  
(埋め込んだサーバー側の変数もこの時評価されます。)  

その結果として出力された文字列が、クライアントにレスポンスされることになります。  




#### Appサーバーへのプログラムの配置方法 
デプロイとは「配置する」、「展開する」という意味で、作成したプログラムをAppサーバーに配置する際などに使われる言葉です。  

作成したWebアプリケーションをAppサーバーにデプロイする方法は、PPサーバーにより異なります。  
基本的にビルドしたプログラムを特定のフォルダに配置し、パスやポートと対応付ける設定を行います。  
それを簡単に行うための機能が用意されているAppサーバーも多いです。  

例  
IISの例  

Tomcatの例  




### 旧

主要な開発言語にはアプリケーションサーバー上で動作するプログラム（以下Webアプリと呼びます）を作成するためのライブラリやフレームワークが用意されています。  

それらのライブラリのフレームワークのルールに乗っ取って処理を実装していきます。  
（例えばWebサーバーアプリが起動したときにはこのメソッドが呼ばれる、URLと対応するメソッドは項定義する、リクエストボディの内容はこの変数に入っている　など）


例

同じ言語でも異なるフレームワークを使うと実装方法が異なります。  

javaの場合  

- Servlet  
Webアプリケーション実装時の仕様。  
例えば以下のような仕様が定義されている。  
  - Webサーバーアプリが起動したときにはこのメソッドが呼ばれる
  - URLと対応するメソッドは項定義する
  - リクエストボディの内容はこの変数に入っている  
  など

- j2ee.jar  
サーブレットの仕様通りに実装されたライブラリ。  
各Appサーバーが用意している。  
またeclipseなどのIDEでも用意されている事が多い。  
(開発時はIDEのjarを利用し、本番時は配置先のAppサーバーのjarを利用する。)

図  


標準のサーブレットだと記述が上長になる為、外部のWebフレームワークライブラリを利用する事も多いです。  
著名なWebフレームワークであるSpringBootを利用すると、Appサーバー(Tomcat)自身を内包した形でプログラムをビルドすることも可能です。  
この場合、Appサーバーアプリがインストールされていない環境でもそのまま実行できます。  
（実行すると作成したプログラムが配置されたTomcatが立ち上がる。）  
こちらの形式の方が取り回ししやすい為、最近のアプリはこの形式が多いです。  

図  

.NETも今はこの形式になっています。  


servlet-apiとAPサーバーの関係  
https://stackoverflow.com/questions/25256768/understanding-who-provides-servlet-api-jar-is-it-web-container-or-part-of-java

各AppサーバーのJ2EEのjar  
https://www.microfocus.co.jp/manuals/ED60/VS2017/GUID-7B2BE673-515D-4204-9B5E-F23B4603D4AE.html

サーブレットの実装  
https://qiita.com/toshi_solution/items/75560ac5353a16703ddc

https://www.ulsystems.co.jp/archives/035.html

spring mvc  
https://spring.pleiades.io/spring-framework/docs/current/reference/html/web.html  

springのメリット  
https://stackoverflow.com/questions/10775522/raw-servlet-vs-spring-mvc

https://www.quora.com/Which-is-better-Java-servlets-or-Spring-to-develop-a-good-website
Springでは、国際化とローカリゼーション、sitemeshのより良い使用、依存性注入、aop、アドバイスなど、jspサーブレットでは得られない多くの機能が提供されます。  

https://spring.pleiades.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/DispatcherServlet.html

spring-boot  
https://www.slideshare.net/OgawaTakeshi/spring-boot-71285225


