# Webサーバーへのパラメータの渡し方

## なにこれ？

## Webサーバーへのパラメータの渡し方
画面の入力値などのパラメータをサーバーに渡したいことがよくあります。  
（例えばユーザー登録画面で登録ボタンを押したときに、ユーザー名や住所などの情報を送りたい など） 
その際はHTTPリクエストにパラメータ情報を含める必要があります。    

HTTPリクエストのどこにどのようにパラメータを含めかについて、いくつか方法があります。  

- クエリストリング
- フォームデータ
- リクエストボディに特定の形式で記載
- リクエストヘッダー

以下それぞれについて説明していきます。  

### クエリストリング  
   URLの末尾の`?`以降の文字列を**クエリ文字列**または**クエリストリング**といいます。　　
   ここにパラメータを記載します。   

   例  
   ```
  http://example.com/?name=yamada&address=hokkaido
   ```

   この場合、`name=yamada&address=hokkaido`の部分がクエリストリングになります。  
   パラメータは`キー=値`の形式で記載し、複数ある場合は`&`で連結します。  
 
   この方法はGETメソッドでリクエストする際に良く用いられます。  
   formタグのmethod属性にGETが指定されていた場合、formタグ内のinputタグなどの入力値が、submit時にクエリストリングに記載されます。  

   詳しくは[別記事]()で解説します。  


####  メリット  
  - URLだけでパラメータ情報を伝えることが出来る  
  URL自体にパラメータ情報が含まれる為、URLをコピーして別タブ・別ブラウザで開いた場合や、お気に入りから再度開いた際も同じパラメータを渡すことが出来ます。  
   
#### デメリット  
  - URLの文字数制限  
  ブラウザによってはURLの文字数の最大値が決まっている為、長いパラメータを渡すことが出来無い場合があります。  
  (IEが2083文字、Safariが4096文字、その他はほぼ制限なし。  
  IEのサポートが切れた後は、Safariの4096が基準になるかと思います。)    
  
  - セキュリティ  
  URLにパラメータが表示されてしまうため、個人情報や機密情報（パスワードなど）のパラメータがある場合セキュリティ的に問題があります。  
  お気に入り登録するとそれらのパラメータ込みのURLが平文で保存されてしまいます。  
  またWebサーバーアプリでアクセスログを出力する場合、大抵のサーバーアプリはリクエストのURLを記録します。  
  その為予期せぬ箇所でそれらの情報が人目に触れてしまう可能性があります。  


### フォームデータの送信
リクエストボディにフォームデータ形式で記述します。     
formタグのmethod属性でPOSTを指定した状態でフォームをサブミットした際、formタグ内のフォームコントロールの値がリクエストボディに記載されます。  

`キー=値`形式で記載され、複数ある場合は`&`で連結されます。  
この形式をのデータを**フォームデータ**と呼びます。  

リクエストヘッダーの`Content-Type`は`application/x-www-form-urlencoded`になります。  

詳しくは[別記事]()で解説します。  
   
#### メリット  
- 文字数制限がない  
クエリストリングとは異なり、リクエストボディには文字数の制限がありません。  

- URLだけでは同じパラメータを渡せない  
URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  
その為、登録・削除などの複数回呼ばれたくない処理によく利用されます。    

- セキュリティ（がクエリストリングよりはよい）  
URLにパラメータが含まれない為、URLをブックマークされてもパラメータが保存されません。  
またWebサーバーのログにもリクエストボディまでは出力しない場合が多いです。  
その為、クエリストリングよりは機密情報などが人目につく確率は低いです。  
(とはいえ完璧に隠ぺいできるわけではないので、あくまで比較するとましであるというだけです。)    
   
####  デメリット  
- ブックマークなどから再度同じ処理を行えない  
メリットの項でも述べましたが、URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  
そのため、ブックマークしてもらいたい画面（参照系の画面で）の場合は使えません。  


ブラウザからリクエストが発行される場合は、上記2つのいずれかの方法でパラメータを渡すことになります。  

### リクエストボディにJson形式で記述  

javascriptなどでHttpリクエストを作って発行する際は、パラメータを自由に記述することが出来ます。  
リクエストヘッダーで渡すことも出来ますし、リクエストボディにフォームデータ形式以外の形式でパラメータを含めることも出来ます。  

その中でもよく使われるのは、jsonの文字列をリクエストボディに含める方法です。  
以下のようなリクエストを発行します。   
```
POST /sample
HOST: 


{


}

```

Javascriptなどのプログラム言語からは以下の手順でHTTPリクエストを作成します。  
1. Javascriptで送信したい値をもったオブジェクトを作成


1. そのオブジェクトをJson文字列に変換  
大半の言語には、オブジェクトをJson文字列にしたり、Json文字列からオブジェクトを作る為のライブラリが存在します。  
Javascriptでは標準の関数として用意されています。  

1. Json文字列をリクエストボディに記載して送信。  
     
   例  
   ```
   const searchCond = {
     searchWord: "商品1",
     maxPrice: "3000"
   }
   ```


#### メリット  
 - 複雑なデータを表現しやすい  
jsonは配列やネストしたデータを表現できるため、そのようなデータを送るのが容易です。   

- プログラムのオブジェクトからの変換が容易  
主要なプログラミング言語にはJson文字列⇔その言語のオブジェクトを変換するライブラリが存在します。  


#### デメリット  
-  サーバー側にもJsonの変換処理が必要  
サーバー側でもリクエストから取り出したJson文字列をサーバー側言語のオブジェクトに変換する処理が必要です。  
ただ上で説明した通り、Json用のライブラリはほとんどの言語に用意されている為、そこまで難しいことではありません。  

サーバー側でWebフレームワークを使っている場合、Jsonとオブジェクトの変換処理を自動で行ってくれる事が多いです。  
この場合変換するコードすら書かなくて良いのですが、そのWebフレームワークのルールは把握しておく必要があります。  

たとえば、リクエストヘッダーに`Content-Type: application/json`を指定しないと自動変換しない、などのルールがある場合があります。  



### どの方法を使うか

- ブラウザからのリクエストの場合
  クエリストリングかフォームデータのいずれかになります。  
  ざっくりと以下のように使い分けることが多いです。

  - パラメータに機密情報を含まない参照系の処理  
    →クエリストリング
  - その他の処理  
    →フォームデータ
  
- Javascriptからの場合  
  自分でHTTPメッセージを作成できるため、コーディング次第でどの形式で  も送れます。  
  （URLにクエリストリングを付与する事も出来ますし、フォームデータ形式で  リクエストボディにパラメータを記載する事も可能です。）  
    
  配列やネストしたデータも受け渡しやすい為、Json文字列としてリクエストボディに記述することが多いです。    

最終的にはそれぞれの方法の特性とWebページの特性を考慮し、設計者・開発者が決めることになります。    

### サーバー側の実装
クライアントからパラメータを渡す場合、サーバー側は動的にWebページを作成する場合が多いです。  
(検索条件に対して検索結果ページを動的に作成 など)  

この場合、サーバー側では動的ページを作成する為、Javaなどで作ったプログラムを実行することになります。  
(詳しくは[別記事]()で解説します。)

そのプログラムでは、クライアントから送られたパラメータをHTTPリクエストから取得する必要があります。  
こちらもクライアントからの送信方法に合わせて実装を変える必要があります。 

サーバー側のパラメータを取得する実装についても紹介していきます。  
（言語やフレームワークによって取り方は違いますので、雰囲気が伝わればと思います。）  

ここではC#のASP.NET MVCの場合の実装例を示します。  

Contextからの取得例を記載する

```c#

```

- クエリストリング
- フォームデータ
- リクエストボディに特定の形式で記載
- リクエストヘッダー

### 実装時の注意  

あるリクエストについてどの方法でパラメータを渡すか決めた際は、クライアント（ブラウザ）で動作するHtmlやJavascriptと、サーバー側のプログラムの両方をその方法に合わせて実装する必要があります。  
例えばクエリストリングで送ると決めれば、htmlやjavascirptはクエリストリングにパラメータを記載するよう実装し、サーバー側はリクエストのクエリストリングからパラメータを取得するように実装することになります。  
クライアント側もサーバー側も同じ開発者が実装する場合（このケースが多いです）は特に問題無いのですが、もし別々の開発者が実装する場合は、事前に受け渡し方法についてよく確認しておくことが大事です。    




