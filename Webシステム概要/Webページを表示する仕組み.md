
# Webサイトを表示する仕組み

## なにこれ？  
皆さんはChromeやSafariなどのブラウザから、googleやyoutubeなどのWebサイトを表示したことがあるかと思います。  
ただ、どのような仕組みでWebサイトが表示されているかまでは分かってない方もいるのではないでしょうか。

弊社の開発案件ではそのようなブラウザからアクセスするWebサイトを作成することも多く、どのような仕組みかを理解する必要があります。

この記事はWebサイトを表示する仕組みを理解できるようになることを目的としています。


## 対象者
Webサイトを表示する仕組みがいまいちよく分からない人  


## Webサイト表示の流れ
まず初めに、Webサイトを表示する際の大まかな流れを記載します。  
その後に、それぞれのフェーズの細かい内容を説明していきます。

1. （人）ブラウザ上にURLを入力


1. （ブラウザ）URLに対応するIPをDNSサーバーから取得
DNSという仕組みでURLに対応するIPを取得します。  
DNSとやり取りする機能はOSに備わっており、ブラウザがそれを利用しています。

1. （ブラウザ）IPを取得したWebサーバーに対して、HTTPリクエストと呼ばれる形式のメッセージを送信
送信する処理はOSに依頼しています。

1. （Webサーバー）HTTPリクエストを受け取り、返却するHtmlを用意  
Htmlとはブラウザが画面を描画する為に必要なファイルです。  
このほかにもcssやjavascriptなどのファイルも返却します。  
詳しくは後ほど説明します。  

1. （Webサーバー）HTTPレスポンスと呼ばれる形式のメッセージで用意したHTMLを返却


1. （ブラウザ）HTTPレスポンスからHtmlを取り出し、その内容に応じで画面を描画する。


<img src="画像/Webサイト表示の流れ.png" style="width:680px;">



## 各部分の詳細

### （ブラウザ）URLからWebサーバーのIPを取得  
ブラウザがURLからWebサーバーのIPを取得する手順は大まかに以下になります。

1. URLからサーバー名に当たる部分を抜き出し  


ブラウザはまずURLを解析し、URLの中からサーバー名を表す箇所を抜き出します。  
URLはいくつかの要素で構成されています。  

例えば以下のURLがあった場合  

http://yahoo.co.jp/aaa/bbb/ccc  

以下のように分解できます。  

http yahoo.co.jp aaa/bbb/ccc  
<img src="画像/URLの構成要素_1.png" style="width:280px;">

このうちプロトコルの後ろの部分がサーバー名になります。  
正確にはサーバーのドメイン名と呼ばれる情報になります。

URLのどこにどの要素が記載されているかは、後述するHTTPの仕様の一部として規定されています。  
URLの仕様についての詳しい解説は別記事で行います。

2. サーバー名に対応するIPをDNSサーバーに問い合わせる  
実際にサーバーと通信する際は、サーバーのドメイン名では無くIPアドレスが必要になります。  
ドメイン名に対応するIPを取得する為にはDNSという仕組みを利用します。  
詳しい内容はネットワーク的な話になるので省略しますが、DNSサーバーに対してドメインに対するIPを教えて下さいとリクエストすることになります。（ネットワーク的な内容を解説している参考書籍を末尾に記載しています。）  
DNSに問い合わせる機能自体は実際はOSが持っており、ブラウザはOSが提供する機能を利用して問い合わせを行っています。  

<img src="画像/DNSサーバーへの問い合わせ.png" style="width:680px;">



DNSサーバーはOSに設定されています。例えばWindowsだと以下の画面から設定できます。  

<img src="画像/DNSの設定箇所.png" style="width:680px;">




ちなみにURLのサーバー名部分に直接IPアドレスを記載することも可能です。  
その場合DNSに問い合わせる手順はスキップされます。  


### （ブラウザ）Webサーバーに対してHTTPリクエストを送信  
ブラウザはHTTPリクエストというメッセージをWebサーバーに送信します。  

HTTPとは何かについて、以下簡単に説明します。  
(もう少し詳しい説明は別記事で行います。)  


> #### HTTPとは  

> クライアント（ブラウザなど）とWebサーバーの間で、さまざまなデータをやりとりするために使用するプロトコル（通信規約）のことです。（HTMLファイルなど）  

HTTPプロトコルの仕様は、IETFという標準化団体が策定しています。  
参考：[仕様文書](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)  


> HTTPでは、HTTPメッセージと呼ばれる文字列データをやり取りして必要な情報を伝え合います。    
> HTTPメッセージには以下の2種類があります。  
> - HTTPリクエスト  
クライアントが送信してサーバーにアクションを起こさせる為のHTTPメッセージ  

> - HTTPレスポンス  
HTTPリクエストに対するサーバーの回答であるHTTPメッセージ  


> 図  


> メッセージの仕様（どこにどんな情報をどうやって記載するか）はHTTPプロトコルの仕様の1部として[規定](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)されています。  

> #### HTTPリクエストの内容
> ブラウザがなどのクライアントが送信するHTTPリクエストは、以下のような文字列になります。  
> 例  


> HTTPリクエストは大まかに以下のブロックに分かれます。  
> - 開始行  
要求メソッド、リクエスト対象（絶対URLからプロトコル名とドメイン名を除いたもの）、HTTPプロトコルのバージョン

> - HTTPヘッダー  
読み込むリソースについての情報や、クライアントに関する詳細な情報を持ちます。  
例えば以下のようなヘッダーがあります。  
- 
- 

HTTPヘッダー部分は空行で終わります。

例  


> - 本文  
主にPOSTメソッドで使用される追加のデータを含みます。  
データが無い場合は省略可能です。  


#### HTTPレスポンスの内容
HTTPリクエストに対する応答として、WebサーバーはHTTPレスポンスメッセージをブラウザに送信します。  
HTTPレスポンスにはHtmlなどのブラウザ側に返却したいコンテンツ情報が含まれています。  

HTTPレスポンスは、以下のような文字列になります。  
例  



図  

HTTPリクエストと同じく、HTTPレスポンスの構文もHTTPの仕様の一部として定義されています。
以下HTTPレスポンスの構造を簡単に説明します。

- ステータス行  
HTTP レスポンスの開始行はステータス行と呼ばれ、以下の情報を持ちます。  
  - プロトコルバージョン  
通常「HTTP/1.1」です。
  - ステータスコード  
リクエストが成功したか失敗したかを示します。例えば200（成功）,404（Not Found）などです。

  - ステータス文字列  
人間がHTTPメッセージを理解するのを助けるための短いテキストです。


- レスポンスヘッダー  
返却するコンテンツの長さや、サーバー情報などの情報が記載されます。
例


- 本文  
ここに応答したい内容が入ります。  
Htmlファイルを返却したい場合は、Htmlファイルの内容が記述されています。  
404など、応答によっては本文が無いものもあります。  


以上が簡単なHTTPの説明になります。  
もう少し詳しい説明は別記事で行います。  

HTTPリクエストを生成し、Webサーバーに送信する、という作業をブラウザが行ってくれます。  
例  
google開いたときのHTTPリクエスト  


### （Webサーバー）HTTPリクエストを受け取り、返却すべきHtmlを用意  

ブラウザから送られてきたHTTPリクエストをWebサーバーが受け取り、Webサーバーアプリに受け渡されます。  


Webサーバーアプリはリクエストの内容を解析し、リクエストの内容によって返すべきコンテンツを準備します。  
今回のような、ブラウザにURLが入力された際のリクエストに対しては、まずHtmlというWebページを表示する為のファイルを返却します。  

どのようなHtmlを返すかは、URLのパスやパラメータによって判断します。  
例えばURLが/loginならログインページ、/mypageならマイページ表示用のHtmlを返す、などです。  
このような、どのリクエストに対してどのコンテンツを返すかのルールは設計者・開発者が決め実装します。

Webページには内容が変わらない静的ファイル（ヘルプページなど）と、条件によって内容が異なる動的ファイル（ユーザーに毎に内容が違うマイページなど）があります。  

動的ファイルの場合は、データベースから取り出した情報をもとにHtmlファイルを作成する、といった処理が必要になります。  
この際にjavaなどの言語で書かれたプログラムを呼び出す必要があります。  
このあたりは後で詳しく説明します。  

### （Webサーバー）コンテンツをHTTPレスポンスで返却

Webサーバーは返却したい情報（この場合はHtml）をHTTPレスポンスとしてブラウザに送信します。  
HTTPレスポンスの本文部分に、返却したい情報が記載されています。  

例  
Googleからのレスポンス例  

### （ブラウザ）HTTPレスポンスからHtmlを取り出し、その内容に応じで画面を描画する。

図

ブラウザがWebサーバーから返却されたHttpレスポンスを解析し、その本文からHtmlファイルを読み取ります。  

Htmlにはブラウザが画面のどこに何を描画すべきかが記載されており、ブラウザはその内容に従って画面を描画します。  

例えば、Htmlに`<button>ボタンです</button>`と記載されていた場合、画面には以下のようにボタンが描画されます。  

図  

このようなHtmlの仕様（Htmlに何が書かれていたら画面に何を描画するかというルール）は、W3CとWHATWGという標準化団体により策定されています。   
策定されて仕様は[HTML Living Standard](https://html.spec.whatwg.org/)という名で公開されています。  

例  
googleのHtml

これでWebサイトを表示する際の流れの説明は完了です。   
みなさんがブラウザでWebサイトを見ている際は、このような処理をブラウザやWebサーバーが行ってくれています。  


## Html、Css、Javascript
ブラウザが画面を描画する際は、上で言及したHtmlに加え、Css・Javascriptというものが利用されます。  

以下それぞれのの概要を説明します。  

### Htmlとは
前述の通り、ブラウザにウェブサイトの構成を伝えるための言語です。  
（このような視覚表現や構造を表現する言語をマークアップ言語といいます。）  

`<`と`>`で囲まれた**タグ**を組み合わせて記述します。  
例えば以下のように記述します。  

`<h1>見出しです</h1>`


左の`<>`で囲まれた部分が**開始タグ**、右の`</>`が**終了タグ**と呼ばれます。  
`<>`の中に書かれている`h1`は、そのタグが何であるかを表します。  
例えば`h1`は、見出しとしてタグで囲まれた部分の文字列を強調表示する、という意味があります。

タグに囲まれた部分は、**a**と呼ばれます。

図  

どのタグが何の意味を持つかは前述した仕様で定義されています。  
他の例として、外部へのリンクを表示する場合は`a`というタグを利用します。  

`<a href='http://google.com'>外部リンクはこちら</a>`  

ここで、`a`というタグ名の横に`href`というものが記載されています。  
これは**属性**とよばれ、タグに情報を付加する為に利用されます。  
`href`はリンクがクリックされた場合の遷移先URLを記載します。  

属性の種類も仕様で定義されており、複数のタグに使われる属性と、特定のタグにのみ使われる属性があります。  


このように開始タグ～終了タグまでのまとまりを**要素**といいます。  

まとめると以下になります。  

図  

htmlはこのような要素を組合せて記述されます。  
要素は並べて記載することも入れ子にする事も可能で、木構造になっています。  

木構造

例えば、ブラウザで適当なサイトを開き、右クリック→ソースを表示 を選択すると、そのサイトのhtmlを見ることが出来ます。  

図  


### Css、Javascript 

画面描画の為にブラウザが使用するものとして、html以外にCss、Javascript と呼ばれるものがあります。  
これらはhtmlとは別の仕様で、異なる文法で記述されます。  

正しお互いに関連は深く、Htmlの特定の箇所に直接CssやJavascriptを記載することが可能です。  
（Htmlとはのファイルとして定義することも可能です。記述場所については以下で詳しく説明します。）  

### Cssとは  
HTMLの要素をどのように修飾（表示）するかを指示する仕様の一つです。  
幅・高さ・色など、見た目のデザインに関する情報を記載します。

Cssは以下のように記載します。  

例  


この例は、この要素の背景色は赤、という定義しています。  
他にも、例えば以下のような定義が可能です。

- 
- 
- 

このようなCssの仕様(backgroundcolorは背景色を表す、などのルール)はW3Cという団体によって[策定](https://www.w3.org/Style/CSS/specs.en.html)されています。  

cssの適用方法は3つあります。  

1. タグのstyle属性に直接指定する  

1. `<style>`タグの内部に記載する  

1. 外部ファイルに記載し、`<style>`タグから参照する

style属性に直接記述する方法だとタグが増えた際に管理が大変になるため、外部ファイルとして定義する事も多いです。  

Cssの詳しい仕様については別の記事で解説します。  

②、③の方法で記載する場合は、***セレクタ***という、どの要素にどの定義を適用するかという情報を記載します。  

セレクタは以下のように記載します。  

例  

これはh1タグの背景色を全て赤色にするという定義です。  
cssでは様々なセレクタを定義できます。  

- タグ


- 特定の属性を持った要素

- 独自の定義

これはhtmlの`class`属性に同様の名前が定義されている要素に適用されます。

cssは他にも特定の属性を持つものを対象にしたり、独自の名前を付けた定義を作成出来ます。  




### Javascriptとは
Webサイトのふるまいを定義する為のプログラミング言語です。  
例えば、あるボタンが押された際にある処理を行う、などの処理を記述します。  


例  

Javascriptはブラウザ上で実行されます。  
サーバー側はJavascriptの文字列を返却しているだけです。  
主要なブラウザはJavascriptの実行エンジンを持っており、読み込んだjavascriptを解析して実行します。  


Javascirptが実行された結果（上の例の背景色の変更など）は、そのブラウザのみで起こっていることです。  
他のクライアントのブラウザに影響しません。  

図


図  
複数クライアントにjavascriptが返されてる図  


javascriptの仕様も標準化団体によって定められているのですが、以下の2つの仕様があります。  

1. javascript自体の言語仕様  
例えば変数やメソッドの定義の仕方などの基本的な部分の定義です。  
TC39という団体により定義されており、その仕様は[ECMAScript](https://tc39.es/ecma262/)と呼ばれています。  


1. Webブラウザ環境で実行する場合特有の機能の仕様  
html要素の操作など、ブラウザ環境で実行される場合限定の機能の仕様が定義されています。  
こちらはHtmlと同じ[Living Standard](https://html.spec.whatwg.org/)として作成されています。  
(Javascriptをサーバーサイドで動かす場合もあるのですが、その場合これらの機能は利用できません。)  

javascriptの記載方法も、cssと同じく３つあります。  

1. タグのイベント属性に直接指定する  

1. `<script>`タグの内部に記載する  

1. 外部ファイルに記載し、`<script>`タグから参照する


#### Html、Css、Javascriptのそれぞれの役割

html、css、javascriptの役割をまとめると以下になります。  
- Html  
Webサイトの構造（どこに何を表示するか）を定義します。  

- Css  
Webサイトのデザインを定義します。  

- Javascript  
Webサイトの振る舞いを定義します。  


#### 外部ファイルの読み込み順  

css、javascriptをhtmlとは別ファイルとした場合、それぞれのファイル毎にHttpリクエストを発行します。  

htmlのタグにはCSSとJavaScriptファイルを読み込むためのタグが用意されています。  


以下のように処理されます。  

1. ブラウザがhtmlファイルを解析

1. htmlファイル内の`<style>`、`<script>`タグで外部ファイルが参照されていた場合、そのURLに対してHttpリクエストを発行し、外部ファイルを取得します。

1. 取得したcssファイル、scriptファイルを解析し、htmlに適用します。  


図


- css
`<style>`タグで指定します。
例

- javascript
`<style>`



## 仕様の策定について
HTTPやHTMLなどの仕様は仕様策定団体によって定義されており、主要なアプリ（ブラウザやWebサーバーアプリ）はその仕様に準拠する形で実装されています。  

例えば、ブラウザはHTTPリクエストを送る際、仕様通り先頭行に要求メソッドなどを記載します。  
Webサーバーアプリも仕様通り先頭行に要求メソッドなどが書かれている前提でHTTPリクエストを解析します。    

このように共通の仕様を前提に各アプリが実装されている為、どのような組合せでもHTTPのやり取りを行えるわけです。  

図  


もし共通の仕様が決まっていなければどうなるでしょうか。  
例えばChromeはHTTPリクエストの先頭行にURLを記載するが、firefoxは末尾の行で定義していたり、apacheはリクエストの先頭行にURLが想定で動作するがnginxは末尾の行の前提で動作する、などなってしまうと、特定のブラウザとWebアプリの組合せでしかやりとりが出来なくなってしまいます。  

例えばブラウザやWebサーバーごとに想定するHttpリクエストの形式が異なっていると、特定のブラウザとWebアプリの組合せでしかやりとりが出来なくなってしまいます。  

図  


HTML、Css、Javascriptにも同じことが言えます。  

Htmlのタグやcssの意味、javascriptの構文やメソッドの処理内容などは、共通の仕様で定義されています。  
各ブラウザはその仕様をもとに実装されているので、どのブラウザで見ても同じWebページを表示できるわけです。  
(後述しますがたまに見れないときはあります。)  

図  
androidやiOSでも見れるのを表す  


もしブラウザごとにそれらの解釈が異なるのなら、各ブラウザ向けに返却するHTMLを変えなくてはいけなくなります。  

図  

そのような事態を避ける為に仕様策定団体が存在しており、各アプリの開発ベンダーもそれに従っているわけです。  

この仕様には強制力はありませんが、仕様に準拠していないアプリは扱いにくくなるため利用者が減ってしまいます。  
その為自然とこの仕様に従うようになります。  



このように共通の仕様や規格を作るのは、Webシステムに限った話ではありません。  
TCP/IPのようなプロトコルもそうですし、USBの形状なども共通の規格が決まっています。  
このように共通の仕様を決めることで、全体の利便性が高まるわけです。  



#### IEについて
上で共通の仕様を各アプリが準拠していると書きましたが、MicrosoftのIEは共通の仕様にあまり対応していませんでした。  
（大まかな部分は準拠していますが、細かい部分で独自の仕様が定義されていたりしました）  

その為、IEと他のブラウザ両方でみれるWebサイトを作る場合、IEが対応していない仕様の機能を使う場合は開発者はIE用と他のブラウザ用の２つの実装をコーディングしなくてはいけないことが多かったです。  
（IEはWindows標準搭載で一定のシェアがあるため無視することは出来ませんでした。）  

ネットで調べ物をするとIEの場合はこうコーディングする、といった情報が書かれている場合がありますが、それは上記の理由の為です。  

IEは2022/9月でサポートが終了しますが、古い業務アプリなどはIEでしか動かないものもあるので注意が必要です。  


#### 各ブラウザの仕様対応状況  
各アプリは共通仕様に対応しようとしていますが、一部の機能に対応していないことがあります。  
特にブラウザ側はURI、Http、Html、css、javascript・・と対応しなければ行けないものが多く、各ブラウザで対応状況に差があります。(IEほどではなくても)  

対応状況は[ここ]()で確認できます。  



## 参考資料  

・MDN HTTPについての説明サイト  
https://developer.mozilla.org/ja/docs/Web/HTTP


・MDN URLとは何か  
https://developer.mozilla.org/ja/docs/Learn/Common_questions/What_is_a_URL



・tomcat
https://wa3.i-3-i.info/word12843.html
https://thinkit.co.jp/free/article/0708/2/1
https://agency-star.co.jp/column/tomcat


・アプリケーションサーバー

https://www.otsuka-shokai.co.jp/words/application-server.html

アプリケーションサーバーにはアプリケーションプログラムによって以下のような種類がある。
（1）Java：「Tomcat」「Glass Fish」
（2）PHP：「Apache」
（3）Ruby：「Unicorn」「Thin」「Rainbows」「Puma」

マイクロソフトのIIS（Internet Information Services）はWebサーバーとアプリケーションサーバーの機能を統合しVisual Basic、C#などの言語で記述したプログラムが作動している。

Appサーバーをwebサーバーとして利用しない理由
https://qiita.com/yCroma/items/e46476e2ac7c372bb2a3

2015年Webサーバアーキテクチャ序論
https://blog.yuuk.io/entry/2015-webserver-architecture



・ブラウザ周りの仕様
https://qiita.com/megmogmog1965/items/e180d02be711cecdc038
