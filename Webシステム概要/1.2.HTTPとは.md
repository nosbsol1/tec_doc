# HTTPとは

## なにこれ？
HTTPというプロトコルについての概要を紹介します。  
クライアントとサーバー間でやり取りされるメッセージの構造やそれぞれの意味について、重要な点に絞って説明していきます。  


## 対象者
HTTPがよく分からない人



## HTTP概要  
クライアント（ブラウザなど）とサーバーの間で、さまざまなデータを転送するために使用するプロトコル（通信規約）のことです。  

HTTPは「Hypertext Transfer Protocol」の略で、ハイパーテキストというデータ（主にHTML）を転送するための通信プロトコルとして生まれました。  
実際にはHtmlだけではなく、画像、動画、PDFなど、コンピュータで扱えるデータなら何でも転送出来ます。  

クライアントもブラウザだけに限りません。  
クライアントアプリケーション(iPhone、Android、Windowsにインストールして実行するアプリ)もサーバーとの通信時にHTTPを利用する事が多いです。  
（クライアントアプリでの利用例については別記事で解説します。）  

図  

HTTPはシンプルな仕様な為、多くの用途で利用されています。  


## HTTPの仕様 

HTTPプロトコルの仕様は、IETFという標準化団体が策定しています。   
仕様文書（[原文](https://httpwg.org/specs/rfc7231.html)、[日本語訳](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)）  

HTTPの仕様は1996年にバージョン1.0が策定され、1999年頃にバージョン1.1が策定されました（「HTTP/1.1」と書きます）。  
このHTTP/1.1が2022年現在でも広く利用されています。  

2015年にはHTTP/2も策定されましたが、パフォーマンスアップの為の変更が主で、基本的な仕様（メッセージの形式など）には大きな変化はありません。  


## リクエスト、レスポンス

HTTPでは、クライアントとサーバー間で**HTTPメッセージ**と呼ばれる文字列データをやり取りして必要な情報を伝え合います。    
まずはクライアントがメッセージを送り、それに応答するメッセージをサーバーが返します。  

それぞれのメッセージは次のように呼ばれます。  
- HTTPリクエストメッセージ  
クライアントが送信してサーバーにアクションを起こさせる為のHTTPメッセージ  

- HTTPレスポンスメッセージ  
HTTPリクエストに対するサーバーの回答であるHTTPメッセージ  

図  


メッセージの仕様（どこにどんな情報をどうやって記載するか）はHTTPプロトコルの仕様の1部として[規定](https://triple-underscore.github.io/rfc-others/RFC2616-ja.html#section-4)されています。  

メッセージの構造は単純です。  
例えば、ブラウザでgoogle.comのWebサイトを開く際、以下のようなメッセージがやりとりされます。  
（行数が増えてしまうので抜粋したものを記載しています。）   

HTTPリクエスト（ブラウザ→Webサーバー）
```
GET / HTTP/1.1
Host: google.com
Accept: text/html,application/xhtml+xmlsigned-exchange;v=b3;q=0.9
Connection: keep-alive

```

HTTPレスポンス（Webサーバー→ブラウザ）
```


```

このようなメッセージをやり取りすることで、クライアントとサーバー間でデータを受け渡しています。  
以下それぞれのメッセージについて説明します。  

## HTTPメッセージ
### HTTPリクエスト  
HTTPリクエストは、以下のような文字列になります。  
例  

```
GET / HTTP/1.1
Host: google.com
Accept: text/html,application/xhtml+xmlsigned-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: ja,en-US;q=0.9,en;q=0.8
Connection: keep-alive

```


HTTPリクエストは大まかに以下のブロックに分かれます。  
#### ・リクエストライン（1行目） 
```
POST / HTTP/1.1
```
の部分に当たります。  
ここは以下の要素で構成されています。  
図  
- メソッド  
  サーバーにリクエストの種類を伝えるために使用します。  
  情報が欲しいときはGET、登録をしたい場合はPOSTを指定、などの使い方をします。  
  詳細は後ほど解説します。  

- リクエスト対象  
  URLのドメイン名以降の部分が入ります。  
  例えばURLが「http://example.com/user/mypage?id=1」だった場合、「/user/mypage?id=1」が入ります。  

- バージョン  
  HTTPのバージョンが入ります。  
  大抵はHTTP/1.1が指定されます。  

#### ・HTTPヘッダー（2行目～空行まで）   
```
Accept: text/html,application/xhtml+xmlsigned-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: ja,en-US;q=0.9,en;q=0.8
Host: google.com
```

の部分に当たります。  
サーバーに様々な情報を伝える目的で使われます。  

例えばレスポンスの言語を指定したり、Cookie（別記事で解説）を記載できます。  
1行につき1つのヘッダー情報を`ヘッダー名: 値`形式で記載します。  
複数ヘッダーがある場合、複数行で構成します。  
 
よく利用されるヘッダーには、以下のようなものがあります。  
- Host  
URLのホスト名とポート番号が記載されます。（80,443ポートは省略可能）  
**このヘッダは必須です。**  

- Accept  
受け入れ可能なリソースのMIMEタイプ（後述）を指定します。   
レスポンスとしてhtml、もしくはimage（画像）ファイルを受け取る場合は、以下のように指定します。  
「」

- Cookie  
Cookieを送信する際に利用します。  
Cookieについては別記事で説明します。  

- User-Agent  
ユーザーエージェント名（ブラウザの種類など）を記載します。  
サーバー側はこのヘッダー値を確認することで、どのブラウザからのリクエストかを判定することが出来ます。  
（IE11がエージェントの場合にだけ違うHTMLを返したい、といった場合に使われることがあります。）

- Content-Length
本文（後述）が存在する場合、そのデータの長さをオクテット（1オクテット＝8ビット）単位で指定します。  

他にも様々なヘッダーがあります。  
ヘッダーはHTTPの仕様の一部としてとして[定義](https://httpwg.org/specs/rfc7231.html#request.header.fields)されています。  


##### ヘッダーの設定方法
ブラウザは、User-Agentにブラウザ自身の情報を記載したり、本文がある場合にContent-Lengthを計算して設定するなど、実行環境に合わせてリクエストヘッダーを自動的に設定します。  

クライアントアプリからリクエストを発行する際は、ヘッダーも意識してHTTPリクエストを作成する必要があります。



#### ・本文（空行から後ろ）  
```

```
の部分に当たります。 

メソッドがPOSTの場合、ヘッダーフィールドの後に本文（リクエストボディ）が続きます。  
主にユーザーが入力した情報などをサーバーに渡したい場合に記載します。  
（データが無い場合は省略可能です。）  

以下メッセージボディがあるリクエストの例です。  

サーバーアプリは、ヘッダーフィールドのContent-Lengthで指定された長さのデータを読むか、通信が終わった時点までを本文として読み込む場合が多いです。  

本文を利用するリクエストについては、別記事で解説しています。    




### HTTPレスポンス
HTTPリクエストに対する応答として、WebサーバーはHTTPレスポンスメッセージをブラウザに送信します。  
HTTPレスポンスにはHtmlなどのブラウザ側に返却したいコンテンツ情報が含まれています。  

HTTPレスポンスは、以下のような文字列になります。  
例  



図  

HTTPリクエストと同じく、HTTPレスポンスの構文もHTTPの仕様の一部として定義されています。
以下HTTPレスポンスの構造を簡単に説明します。

#### ・ステータスライン （1行目） 
```

```
の部分を指します。  

ステータスラインは以下の情報を持ちます。  

- プロトコルバージョン  
HTTPのバージョンを表します。  
通常「HTTP/1.1」です。  


- ステータスコード  
HTTPリクエストがどのように処理されたを示す3桁の数字コードです。  
よく使われるステータスコードには、以下のようのなものがあります。  
  - 200  
  処理が正常に終了したことを示す。  

  - 301
  リダイレクトをする必要があることを示す。  
  この場合、ブラウザはレスポンスヘッダーの`Location`ヘッダーに記載されたURLに自動的に遷移する。  

  - 404  
  リクエストされたパスの対する処理が見つからなかったことを示す。 
  URLが間違っていた際などによく返却される。  

  - 500
  サーバー側で何らかのエラーが発生した状態

  301レスポンスのように、ステータスコードによってはブラウザが特定の動作をするものがあります。  

- 説明句  
ステータスコードに対する補足の情報を文字列として持ちます。  
人間が判断する為のもので、ブラウザの処理には影響を与えません。  
どのような文字列でもよいのですが、ステータスコード毎に一般的に設定される文字列があります。  
例エバ以下になります。    
(200のとき): OK  
(301のとき): Moved Permanently  
(404のとき): Not Found  

#### ・レスポンスヘッダー（2行目～空行まで）    
リクエストと同じく、様々な情報を伝える目的で使われます。 
 
記述の形式もリクエストと同じ（`ヘッダー名: 値`）ですが、利用されるフィールドは異なります。

例えば以下のようなヘッダーがあります。  
- Date  
レスポンスを生成した日時を示す。

- Last-Modified  
リソースの最終更新日時を示す。  
静的ファイルを返却する場合に指定され、キャッシュ動作の際に利用されます。  

- Set-Cookie  
サーバーがCookie値を指定する際に指定します。  
（Cookieに関しては[別記事]()で解説します。）

- Content-Length  
後述する本文が存在する場合、そのデータ長を示します。  
(オクテット単位)

- Content-Type  
レスポンスするリソースの種類を示すMIMEタイプ（後述）を指定する。  
例えばHtmlを返す場合は、「text/html」を指定する。  
ブラウザはこのヘッダーを見てレスポンスホディをどう扱うかを判断します。  


#### 本文（空行から後ろ）  
レスポンスボディとも呼ばれます。  
ここに応答したい内容本体が入ります。  
Htmlファイルを返却したい場合は、Htmlファイルの内容が記述されています。  
応答によっては本文が無いものもあります。  

図  




### HTTPメッセージの構造  
まとめると、リクエスト・レスポンスのどちらも以下の構造になります。  
ただしそれぞれ1行目の内容やヘッダーの種類が異なります。  

図  

以上が簡単なHTTPの説明になります。  




## HTTPメソッド
HTTPリクエストの先頭行に記載されるHTTPメソッドについて、少し詳しく説明します。  

```
GET / HTTP/1.1
```

HTTPメソッドは、指定したURLのリソースに対して、どのような処理をしたいかをサーバーに伝える為に使われます。  
メソッドもHTTPの仕様の一部として[定義]()されています。  
主に使われるメソッドは以下で、それぞれの意味が定義されています。  


|  メソッド  |  意味  | 
|  ----  |  ----  | 
| GET | データの取得 | 
| POST | データの作成・追加、その他処理全般 | 
| PUT | データの更新・作成 | 
| DELETE | データの削除 | 


このうち特に使われるのがGET、POSTです。  

ブラウザが自動的に発行するリクエストは、GETかPOSTいずれかのメソッドになります。  
URLを入力した際やリンクをクリックした際はGET、フォームデータの送信時はGETもしくはPOSTを指定できます。  
(ブラウザが発行するリクエストの種類については[別記事]()で解説します。) 

PUTやDELETEは、javascriptなどにて直接HTTPリクエストを作成・送信する場合に使用されます。  



POSTはデータの作成・追加が主な意味ですが、実際はどの用途でも使われています。  
何らかの制限で他のメソッドを使えない場合はとりあえずPOSTを使うことになります。  
(データの取得だがURLが長くなりすぎてブラウザの制限に引っかかる場合など)


### HTTPメソッドの利用方法
HTTPメソッドはサーバーにどのような処理を行いたいが伝えるための物と説明しました。  
(データが欲しいときはGET、データを登録・更新したい場合はPOSTなど)

ただ実際にどのような処理をするかはサーバー側の実装によります。  
例えばGETメソッドで削除処理をするようサーバー側を実装することも可能です。  

またHTTPメソッドをどれだけ重視するかも設計者・実装者次第になります。
例えばURLを同じにして、HTTPメソッドで処理を分けるようにサーバーを実装することもできます。  
それとは逆にメソッドは同一にPOSTを使用し、URLのリクエストパスやパラメータで処理を分ける事も可能です。  

- メソッドで処理を分ける場合
   ```
   データ取得
   GET /user?id=1 HTTP/1.1
   
   データ削除
   DELETE /user?id=1 HTTP/1.1
   ```

- URLのパスやパラメータで処理を分ける場合
   ```
   データ取得
   POST /user/get?id=1 HTTP/1.1
   
   データ削除
   POST /user/delete?id=1 HTTP/1.1
   ```

どちらにするかは、分かりやすさやサーバー側の実装のしやすさなどを考慮し、設計者・実装者が判断する事です。  
HTTPメソッドはあくまでサーバー側で処理を判断する材料の1つということです。  




## MIMEタイプ
リクエスト・レスポンスヘッダーの「Content-Type」ヘッダーでは、本文に記載されているもののデータ形式（リソースの種類）を記載します。  
これを「MIMEタイプ」や「メディアタイプ」と呼びます。  

MIMEタイプに指定可能な値はIANAという団体によって策定されています。  
[MIMEタイプ一覧]()


### よく利用されるMIMEタイプ

- text/html  
HTMLを表します。  
Webサイトを表示する場合のHTTPレスポンスには、ほとんどこれが指定されます。  

- application/json  
JSON形式のデータを表します。  
javascriptやクライアントアプリからのリクエストでよく利用されます。  
（詳しくは[別記事]()で解説します。）  

- image/png、image/jpeg、image/gif  
画像ファイルを表します。  
ブラウザはHTMLのimg要素のsrc属性にURLが指定されていた場合、そのURLにリクエストを発行し、結果を画像としてimg要素の箇所に表示します。  
その際のレスポンスヘッダーに指定されることが多いです。  



- application/octet-stream   



### MIMEタイプが不明な場合のブラウザの動作
「Content-Type」が指定されていない、もしくは未知のMIMEタイプが指定されていた場合、ブラウザは実際に本文を読み込み、その内容からMIMEタイプを推測します。（これを「MIME sniffing」と言います）

それでも不明な場合は、ダウンロードダイアログを表示し、未知のファイルとして保存するか確認することが一般的です。  


## HTTPという共通仕様が策定されている意味
上記説明してきたように、ブラウザやWebサーバーはHTTPの仕様に基づいたリクエスト・レスポンスをやりとりしています。  
例えば、ブラウザはCookieを送りたい場合Cookieヘッダーに記載しますし、サーバーアプリはCookie情報を取得したい場合Cookieヘッダー確認します。  
サーバーはブラウザに返却する内容をヘッダー後ろの本文の位置に記述しますし、ブラウザは本文を取り出したい場合はヘッダー後ろの本文の位置から取得します。  

このように、どこに何が書かれているか、それがどんな意味かが仕様として決まっているため、それに準拠しているクライアントとサーバー同士ならどんな組み合わせでもデータをやり取りすることが出来るわけです。  


図  



