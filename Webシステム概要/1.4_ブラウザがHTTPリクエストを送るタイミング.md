
## ブラウザがHTTPリクエストを送るタイミング
ブラウザがHTTPリクエストを送信するタイミングは以下になります。  

### ブラウザURLを直接入力した場合  
  入力されたURL（のホスト名のIP）に対してHTTPリクエストを送信します。  
  
  ブラウザが送信するHTTPはGETメソッドとなります。
  Webページ全体が再読み込みされ、javascriptの変数などの情報は全てクリアされます。  

### ページ上のリンクから遷移した際  
  例えばyahooのニュースクリックした際などの動作です。  
  URLを直接入力したときと動きは同じです。  

  リンクはhtml上はaタグで作成されており、そのhref属性に指定されたURLにリクエストを発行します。  
  ```
  <a href="https://google.com"></a>
  ```
<br/>


### フォームデータの送信時  
フォームとはhtmlの`<form>`タグで囲まれた部分の事で、画面上でユーザーが入力した情報をサーバーに送信する際などに利用します。  
例えばユーザー登録画面で、顧客が入力した名前などの情報をサーバーに送る場合などです。  

例  
<form action="http://www.foo.com" method="GET">
  名前 <input name="name"/>
  住所 <input name="tel"/>
  <button type="submit">送信</button>
</form>

Htmlは以下になります。  
```
<form action="http://www.foo.com" method="GET">
  名前<input name="name"/>
  住所<input name="tel"/>
  <button type="submit">送信</button>
</form>
```

`<form>`タグの中にある、`type="submit"`属性が指定された`<button>`をクリックすると、formタグのaction属性に指定されたURLにHTTPリクエストが送信されます。  
（この動作を「フォームをサブミットする」などと言います。）    
その際のHTTPメソッドは`method`属性で指定されたものになります。  
`method`属性には`GET`、もしくは`POST`が指定できます。  


#### フォームコントロール
`<form>`タグの中には、人が値を入力できるHtm要素である**フォームコントロール**要素を配置します。  
`<input>`や`<select>`などです。  

・inputタグ  
```<input name="tel">```  
<input name="tel">  
入力された値は`value`属性に設定されます。   
```<input name="tel" value="000-0000-000">```  
<input name="tel" value="000-0000-000">

・selectタグ  
```<select name="select"><option>値1</option><option>値2</option></select>```  
<select name="select"><option>値1</option><option>値2</option></select>  

選択されたoption要素にselected属性が付きます。  
```<option selected>値2</option>```  
<select name="select"><option>値1</option><option selected>値2</option></select>  

他にも`<redio>`や`<checkbox>`などがあります。  

入力された値はフォームコントロール毎に特定の属性に設定されます。  
input要素の場合入力された値は`value`属性に設定されます。  
```<input name="tel" value="000-0000-000">```  
selectの場合は選択した要素にselected属性が付きます。  
```<option selected>値2</option>```

#### 入力値のサーバーへの送信
**フォームコントロール**の入力値は、HTTPリクエストに記載されサーバー送信されます。  
そのように記載されるかは、`method`に指定したHTTPメソッドによって異なります。  

##### GETの場合  
URLのクエリストリングに記載されます。  
クエリストリングに以下の形式で記載されます。  
`フォームコントロールのname属性の値=フォームコントロールに入力した値`

例  
```
  <form method="GET" action="http://example.com/register">
    <input name="name" value="名前１"/>
    <input name="tel" value="000-0000-000"/>
  </form>
```
<form method="GET" action="http://example.com/register">
   <input name="name" value="名前1"/>
  <input name="tel" value="000-0000-000"/>
</form>
  
このformをsubmitした際のクエリストリングは以下になります。  
```
http://example.com/register?name=名前1&tel=000-0000-000
```

※全角文字はURLエンコードという処理がされたものが送信されます。  
  詳しくは別記事で解説します。  

##### POSTの場合  
HTTPリクエストのリクエストボディに記載されます。  
形式はクエリストリングの場合と同じです。  
`フォームコントロールのname属性の値=フォームコントロールに入力した値`

```
  <form method="POST" action="http://example.com/register">
    <input name="name" value="名前１"/>
    <input name="tel" value="000-0000-000"/>
  </form>
```
このformをsubmitした際のHTTPリクエストは以下になります。
  HTTPリクエストの例
```
POST /register HTTP/1.1
Host: example.com
他のヘッダーは省略

name=名前1&tel=000-0000-000

```

#### GETとPOSTのどちらを選ぶか  
GETとPOSTで以下のような特徴があります。 
 
- GET  
  URLさえあれば同じパラメータを送信できます。  
  その為、ブックマークされ別のタイミングで表示されるページによく利用されます。  
  (検索結果画面などの参照系のページ)  
  
  ただ、送信する値が多い場合、ブラウザによるURLの文字列制限に引っかかる可能性があります。  
  その場合は参照系の画面であっても、文字数制限のないPOSTを利用する事になります。  

- POST  
  URLにパラメータが含まれない為、URLだけをコピーしても同じ処理は行えません。
  その為、ブックマークされ再度リクエストを送られたくないURLによく利用されます。
  （登録、削除を行う処理のURLなど）  
  
  またパラメータに個人情報や機密情報が含まれる場合も、URLに表示されることを避けPOSTを利用することが多いです。  
  （URLを別の人に見られる可能性があります。  
  またWebサーバー側のログを取っている場合、リクエストされたURLを記録している場合が多く、パスワードなどをGETで送るとそのまま記録されてしまいます。  
  ですが、リクエストボディまでは記録しないことが多いです。）
  
  リクエストボディには文字数の制限がない為、パラメータ数が多くなる場合は参照系の画面でも利用されます。  


### javascriptからのリクエスト  

上の3つは、ブラウザがHTTPリクエストの作成・送信とレスポンスに対する処理（Htmlの描画）を自動で行ってくれました。  
それとは別に、ブラウザ上に読み込まれたJavascriptからリクエストを発行する事も出来ます。  
この場合、Httpメッセージの作成・送信やレスポンスに対する処理を自分でコーディングしなくてはいけません。  
ただしHttp通信を行うための関数が標準で用意されているため、１から全て実装しなければいけないわけではありません。   

用意されている方法は2種類あり、XMLRequestとFetchの2種類あります。  

- XMLRequest  
こちらは古くからある方法で、IEでも動作します。  
ただコードが冗長になる為、IEのサポートが切れる2022/7以降はFetchを使った方がいいです。  
記述例  
```

```
- Fetch 
こちらの方が新しい方法で、IE以外のブラウザなら対応しています。  
XMLRequestと比べてコードもきれいに書けるため、IE対応が必要なければこちらを利用する方がいいです。  

記述例  
```

```

#### javascriptからのリクエストの特徴  
javascriptからリクエストを発行しても、ブラウザは何もしません。  
URLを入力してページを開いた時のような、ページの再読み込みや画面の再描画は行いませんし、ブラウザ上のURLも変更されません。  
その為、ブラウザを操作しているユーザーに気付かれずにリクエストを発行することが出来ます。  

また、レスポンスに対してどのような処理を行うかもJavascriptのコードで記述します。

また、レスポンスに対してどのような処理を行うかもJavascriptのコードで記述する必要があります。  
（逆に言うとレスポンスに対しどのような処理を行うか開発者が自由に定義できます。）  

javascriptからのリクエスト発行は主に以下の用途で使われます。  

- ログの送信  
ボタンのクリックなど、ユーザーの行動ログをサーバーに送る際に利用します。  
前述した通りリクエストを発行してもブラウザ上は何の変化も無い為、ユーザーに影響を与えずログを送信できます。  


- サーバーからの情報をもとに画面の一部を書き換える  
ブラウザで動作するjavascriptには、表示中のHtml要素を書き変え再描画出来る機能（API）が用意されています。  
（そのようなHtmlを操作する為のAPIを**DOM**といいます。）  

これを利用し、Webサーバーから受け取った情報を元に、画面の一部を書き換えることが出来ます。  

例えば検索ボタンを押した際、Javascriptから検索の為のHttpリクエストを発行し、Webサーバーからのレスポンスを元に検索結果リストを変更する、などです。  

図  
gif  


図  

検索結果用のWebページに遷移する場合と比べ、ページの再読み込みが発生しない為、ユーザーからすると反応が早く感じます。（サクサク動いているように感じるということです）  
このようにJavascriptでHTTPリクエストを発行し画面の一部を置き換える仕組みを**ajax**と呼びます。  
ユーザーエクスペリエンスを向上出来るため、今時のWebサイトではよく使われています。  

ページの一部を書き換えるコードは以下のようになります。  
例   
```

```


Webサーバーからのレスポンスでは、htmlではなく、プログラムで解釈しやすり**Json**という形式のファイルを返すことが多いです。  

### ブラウザがHTTPリクエストを送るタイミングまとめ  

以下、それぞれの呼び出し方の特徴をまとめました。  

|    |  HTTPメソッド  |  HTTPリクエストの送信  |  HTTPレスポンスへの対応  |    |
| ---- | ---- | ---- | ---- | ---- |
|  URLを直接入力   |  GET  | ブラウザが行う  | ブラウザが行う  |   |
|  リンクから遷移  |  GET  | ブラウザが行う  | ブラウザが行う  |   |
|  フォームデータの送信  |  GET or POST <br>(formタグのmethod属性で指定する)  | ブラウザが行う  | ブラウザが行う  |   |
|  javascriptから送信  |  自由<br>（Httpメッセージ作成メソッドの引数で指定する。）  | javascriptでコーディング  | javascriptでコーディング  |   |

