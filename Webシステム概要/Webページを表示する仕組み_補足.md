
# Webサイトを表示する仕組み_補足

## なにこれ？  
Webサイトを表示する仕組みで説明しきれなかった内容についてまとめました。  




## HTTPメソッド
HTTPメソッドとは、HTTPリクエストの先頭に記載されるもので、行いたい処理をサーバーに伝える為に使われます。  
```
GET / HTTP/1.1
```

主に使われるメソッドは以下で、それぞれの意味が定義されています。  


|  メソッド  |  意味  | 
|  ----  |  ----  | 
| GET | データの取得 | 
| POST | データの作成・追加、その他処理全般 | 
| PUT | データの更新・作成 | 
| DELETE | データの削除 | 

このうち特に使われるのがGET、POSTです。  
ブラウザが自動的に発行するリクエストは、GETかPOSTいずれかのメソッドになります。  
（後述しますが、URLを入力した際やリンクをクリックした際はGET、フォームデータの送信時はGETもしくはPOSTを指定できます。）  
PUTやDELETEは、javascriptなどにて直接HTTPリクエストを作成・送信する場合に使用されます。  

POSTはデータの作成・追加が主な意味ですが、実際はどの用途でも使われています。  
何らかの制限で他のメソッドを使えない場合はとりあえずPOSTを使うことになります。  
(データの取得だがURLが長くなりすぎてブラウザの制限に引っかかる場合など)


各メソッドはあくまでこういう意味で使用して下さいと定義されているだけなので、例えばGETメソッドで削除処理をするようサーバー側を実装することも可能です。  
ただそうすると利用者側も実装者側も混乱するので、出来るだけメソッドと実際の処理は乖離しないようにします。  


これらのメソッドはクライアントから送信されるものですが、どういったメソッドを送るべきかはサーバー側の実装によります。  
サーバー側の実装に合わせて
参照系のリクエストはGET、登録系はPOSTとルールを決めたら、クライアントもサーバーもそれに合わせて実装します。  

メソッドの意味と実際の処理を合わせておくと分かりやすくなります。  
サーバーのリクエストログを見た際も、メソッドを見ただけでどの種類の処理が呼ばれたか判別できます。  

サーバー側はどのような処理を行うか判定する際の条件に、HTTPメソッドを使うことも可能です。  
外部公開するAPIなどはURLを同じで、HTTPメソッドで処理が分かれるようになっていることがあります。  
このような作り方をREST APIと呼びます。  

### REST
### 利用方法  
サーバー側にて、どの処理を行うか判定する為の要素の１つとして利用されます。  
例えばURLを同じにして、HTTPメソッドで処理を分けるようにサーバーを実装することがあります。  
例  
GETなら情報を取得  
```
GET /user?id=1 HTTP/1.1
```
DELETEなら削除
```
DELETE /user?id=1 HTTP/1.1
```

ただこのような判定は、メソッドではなくURLのパスなどで判断する事も可能です。  

例
```
POST /user/get?id=1 HTTP/1.1

POST /user/delete?id=1 HTTP/1.1
```


どちらにするかは、分かりやすさやサーバー側の実装のしやすさなどを考慮し、設計者・実装者が判断する事です。  


## ブラウザがHTTPリクエストを送るタイミング
ブラウザがHTTPリクエストを送信するタイミングは以下になります。  

### ブラウザURLを直接入力した場合  
  入力されたURL（のホスト名のIP）に対してHTTPリクエストを送信します。  
  
  ブラウザが送信するHTTPはGETメソッドとなります。
  Webページ全体が再読み込みされ、javascriptの変数などの情報は全てクリアされます。  

### ページ上のリンクから遷移した際  
  例えばyahooのニュースクリックした際などの動作です。  
  URLを直接入力したときと動きは同じです。  

  リンクはhtml上はaタグで作成されており、そのhref属性に指定されたURLにリクエストを発行します。  
  ```
  <a href="https://google.com"></a>
  ```
<br/>


### フォームデータの送信時  
フォームとはhtmlの`<form>`タグで囲まれた部分の事で、画面上でユーザーが入力した情報をサーバーに送信する際などに利用します。  
例えばユーザー登録画面で、顧客が入力した名前などの情報をサーバーに送る場合などです。  

例  
<form action="http://www.foo.com" method="GET">
  名前 <input name="name"/>
  住所 <input name="tel"/>
  <button type="submit">送信</button>
</form>

Htmlは以下になります。  
```
<form action="http://www.foo.com" method="GET">
  名前<input name="name"/>
  住所<input name="tel"/>
  <button type="submit">送信</button>
</form>
```

`<form>`タグの中にある、`type="submit"`属性が指定された`<button>`をクリックすると、formタグのaction属性に指定されたURLにHTTPリクエストが送信されます。  
（この動作を「フォームをサブミットする」などと言います。）    
その際のHTTPメソッドは`method`属性で指定されたものになります。  
`method`属性には`GET`、もしくは`POST`が指定できます。  


#### フォームコントロール
`<form>`タグの中には、人が値を入力できるHtm要素である**フォームコントロール**要素を配置します。  
`<input>`や`<select>`などです。  

・inputタグ  
```<input name="tel">```  
<input name="tel">  
入力された値は`value`属性に設定されます。   
```<input name="tel" value="000-0000-000">```  
<input name="tel" value="000-0000-000">

・selectタグ  
```<select name="select"><option>値1</option><option>値2</option></select>```  
<select name="select"><option>値1</option><option>値2</option></select>  

選択されたoption要素にselected属性が付きます。  
```<option selected>値2</option>```  
<select name="select"><option>値1</option><option selected>値2</option></select>  

他にも`<redio>`や`<checkbox>`などがあります。  

入力された値はフォームコントロール毎に特定の属性に設定されます。  
input要素の場合入力された値は`value`属性に設定されます。  
```<input name="tel" value="000-0000-000">```  
selectの場合は選択した要素にselected属性が付きます。  
```<option selected>値2</option>```

#### 入力値のサーバーへの送信
**フォームコントロール**の入力値は、HTTPリクエストに記載されサーバー送信されます。  
そのように記載されるかは、`method`に指定したHTTPメソッドによって異なります。  

##### GETの場合  
URLのクエリストリングに記載されます。  
クエリストリングに以下の形式で記載されます。  
`フォームコントロールのname属性の値=フォームコントロールに入力した値`

例  
```
  <form method="GET" action="http://example.com/register">
    <input name="name" value="名前１"/>
    <input name="tel" value="000-0000-000"/>
  </form>
```
<form method="GET" action="http://example.com/register">
   <input name="name" value="名前1"/>
  <input name="tel" value="000-0000-000"/>
</form>
  
このformをsubmitした際のクエリストリングは以下になります。  
```
http://example.com/register?name=名前1&tel=000-0000-000
```

※全角文字はURLエンコードという処理がされたものが送信されます。  
  詳しくは別記事で解説します。  

##### POSTの場合  
HTTPリクエストのリクエストボディに記載されます。  
形式はクエリストリングの場合と同じです。  
`フォームコントロールのname属性の値=フォームコントロールに入力した値`

```
  <form method="POST" action="http://example.com/register">
    <input name="name" value="名前１"/>
    <input name="tel" value="000-0000-000"/>
  </form>
```
このformをsubmitした際のHTTPリクエストは以下になります。
  HTTPリクエストの例
```
POST /register HTTP/1.1
Host: example.com
他のヘッダーは省略

name=名前1&tel=000-0000-000

```

#### GETとPOSTのどちらを選ぶか  
GETとPOSTで以下のような特徴があります。 
 
- GET  
URLさえあれば同じパラメータを送信できます。  
その為、ブックマークされ別のタイミングで表示されるページによく利用されます。  
(検索結果画面などの参照系のページ)

ただ、送信する値が多い場合、ブラウザによるURLの文字列制限に引っかかる可能性があります。  
その場合は参照系の画面であっても、文字数制限のないPOSTを利用する事になります。  

・POST
URLにパラメータが含まれない為、URLだけをコピーしても同じ処理は行えません。
その為、ブックマークされ再度リクエストを送られたくないURLによく利用されます。
（登録、削除を行う処理のURLなど）  

またパラメータに個人情報や機密情報が含まれる場合も、URLに表示されることを避けPOSTを利用することが多いです。  
（URLを別の人に見られる可能性があります。  
またWebサーバー側のログを取っている場合、リクエストされたURLを記録している場合が多く、パスワードなどをGETで送るとそのまま記録されてしまいます。  
ですが、リクエストボディまでは記録しないことが多いです。）

リクエストボディには文字数の制限がない為、パラメータ数が多くなる場合は参照系の画面でも利用されます。  


### javascriptからのリクエスト  

上の2つの場合は、ブラウザがHTTPリクエストの作成・送信とレスポンスに対する処理（Htmlの描画）を自動で行ってくれました。  
それとは別に、ブラウザに返却したJavascriptからリクエストを発行する事も出来ます。  
この場合、Httpメッセージの作成・送信やレスポンスに対する処理を自分でコーディングしなくてはいけません。  

ただし１から全て実装しなければいけないのではなく、Http通信を行うための関数が標準仕様で用意されています。   
用意されている方法は2種類あり、XMLRequestとFetchの2種類あります。  

Fetchの方が新しく、IE以外のブラウザなら対応しています。  
IEのサポートは2022/7に切れるため、それ以降はFetchが主に使われることになります。  


サーバーからのレスポンスに対してもブラウザは何もしない為、自分でどのような処理をしたいかjavascript上デコーディングする必要があります。  
（例えばサーバーから返ってきた値を画面のどこかに表示するなど）  

その関数でがHttpレスポンスを受け取ることも出来ます。  
そのレスポンスに対する処理もコードで記述する必要があります。  

例  
最初に例かく？　　

この方法でリクエストを投げた場合、ブラウザはページの再読み込みを行いません。  
その為、今のページのままで画面の一部を変更したい場合などによく利用します。  
（検索を押したら検索結果を表示している部分だけを変えるなど。）  
またjavascriptで持つ変数などもそのままになります。  

図  
gif  

また、サーバーからの戻り値はhtmlではなく、プログラムで解釈しやすり**Json**という形式のファイルを返すことが多いです。  

#### Json
プロパティ名:値 形式のフォーマットです。  

例    

javascriptのオブジェクトにそのまま変換できます。  

例  


以下、それぞれの呼び出し方の特徴をまとめました。  

|    |  HTTPメソッド  |  HTTPリクエストの送信  |  HTTPレスポンスへの対応  |    |
| ---- | ---- | ---- | ---- | ---- |
|  リンクから遷移  |  GET  | ブラウザが行う  | ブラウザが行う  |   |
|  フォームデータの送信  |  GET or POST <br>(formタグのmethod属性で指定する)  | ブラウザが行う  | ブラウザが行う  |   |
|  javascriptから送信  |  自由<br>（Httpメッセージ作成メソッドの引数で指定する。）  | javascriptでコーディング  | javascriptでコーディング  |   |


## Webサーバーへのパラメータの渡し方
画面の入力値などのパラメータをサーバーに渡したいことがよくあります。  
（例えばユーザー登録画面で登録ボタンを押したときに、ユーザー名や住所などの情報を送りたい など） 

その際はHTTPリクエストにパラメータ情報を含めてサーバーに送ることになります。    
リクエストにパラメータを含める方法はいくつかあります。  



1. クエリストリング  
URLの末尾の`?`以降の文字列にパラメータを記載します。   
 
例  

パラメータは`キー=値`の形式で記載します。  
URLのこの部分を**クエリ文字列**といいます。

この方法はGETメソッドでリクエストする際に良く用いられます。  
formタグのmethod属性にGETが指定されていた場合、formタグ内のinputタグなどの入力値が、submit時にクエリストリングに記載されます。  

  - メリット  
  URLにパラメータ情報が含まれている為、お気に入りから再度開いた際などでも同じパラメータを渡すことが出来ます。  

  - デメリット  
  ただブラウザによってURLの文字数の最大値が決まっている為、あまり長いパラメータを渡すことは出来ません。  



1. リクエストボディにフォームデータ形式で記述  
formタグのmethod属性でPOSTを指定していた場合、formタグ内のinputタグなどの入力値が、submit時にリクエストボディに記載されます。  

例  

ボディにはキー=値形式で記載され、複数ある場合は&で連結されます。  

  - メリット  
  URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  
  その為、登録・削除などの複数回呼ばれたくない処理や、URLに表示したくない情報（個人情報や機密情報）がある場合によく利用されます。
  また、パラメータの文字数制限もありません。  

  - デメリット  
URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  



1. リクエストボディにフォームデータ以外の形式で記述  
javascriptなどでHttpリクエストを自分で作って発行する際は、リクエストボディにフォームデータ形式以外の形式でパラメータを含めることがあります。  
よく使われるのはjsonの文字列をリクエストボディに含める方法です。  

例  

  - メリット  
  配列やネストしたデータなどはjsonの方が表現しやすい為、プログラムからデータを送る際はこの形式で送ることが多いです。  
（json形式に変換する為のメソッドもある為、処理も簡単です。 ）

  - デメリット  
  サーバー側で再変換しやすい形式にしないとサーバー側の実装が面倒になります。  


まとめると以下になります。  

|    |  メリット  |  デメリット   |    |    |
| ---- | ---- | ---- | ---- | ---- |
|  クエリストリング  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ形式で記述  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ以外の形式で記述  |  GET  | GET  | GET  |   |

### どの方法を使うか

ブラウザのformタグからリクエストを送る場合は①か②のいずれかの形式になります。  
javascriptからの場合はコーディング次第でどの形式でも送れます。  

どの方法でパラメータを送るかは、それぞれの方法の特性とWebページの特性を考慮して設計者・開発者が決めることです。  
（検索処理はクエリストリング、登録処理はリクエストボディに記載　など）

実装する際は、クライアント側のHtmlやjavascriptも、サーバー側のプログラムも同じ開発者が実装することが多いです。  
例えばクエリストリングで送ると決めれば、htmlやjavascirptはそのようなリクエストを送るように実装し、サーバー側はリクエストのクエリストリングからパラメータを取得するように実装することになります。  


ajax
従来型との比較

## SPA（シングルページアプリケーション）とは  
ブラウザでリンクを遷移した場合（例えばyahooのニュースを表示した場合）やWebページをリフレッシュした際、タブの横にロード中のマークが表示され、画面が一瞬真っ白になった後画面が再描画されます。  

gif  

このような方法だと画面の表示に1秒くらい掛かってしまいます。  
余り頻繁に操作しない作業ならこれでも問題無いのですが、頻繁に操作するような画面だとこれがストレスになってしまいます。  
（例えばブラウザ版のoutlookやgmailなど。  
メールをクリックする度に画面全体が再読み込みされるとが悪くなります。）  

上でリクエストの方法の項で、javascriptでのリクエスト送信した際はページが再読み込みされないと説明しました。  
これを利用することで、ページ全体を再読み込みせずにWebページの一部を変更することが可能になります。  

ブラウザ版のoutlookやgmailでは実際にこの方法が利用されており、メールをクリックすると、画面の再読み込み無く右側にメールの本文が表示されます。  

gif

このように、画面全体を変更せずにjavascriptにて画面を変更していくWebページを、**SPA（シングルページアプリケーション）**と呼びます。  

SPAのメリットは上でも述べましたがサクサク表示出来て操作感がよいことです。  
業務アプリは頻繁に操作するものも多く、SPA形式にすることが多いです。 

デメリットとしては、実装が少し複雑になることです。  
画面のリフレッシュやURLをコピーして別タブで開かれたような場合、javascriptの変数などもクリアされてしまうので、そうした場合もちゃんとページが表示されるよう実装を工夫する必要があります。  
具体的には、historyAPIというページ遷移無しURLを変更するjavascriptの関数を利用し、ページ書き換え時にパラメータ（開いているメールのidなど）をURLに追加する事が多いです。  

ページロード時のイベントで上記パラメータを取得し、適切な処理（メールデータを取得するなど）を行います。  




## Webアプリケーションの公開  
Webサイトを公開する際は、以下の手順を



## いろいろな呼び方
Webサイトの集合体。
例えばECサイトならマイページ、商品一覧、注文ページなど、それらを表示する為の機能をまとめたものをWebアプリケーションという。

図
各ページの図＋プログラムをWebサイトに乗せる図？


## クライアントアプリからの呼び出し  


